<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Focus Timer</title>
    <style>
        /* =========================================
           STEP 1: CUSTOMIZE YOUR LOOK HERE
           ========================================= */
        :root {
            /* --- DAY THEME (Nature) --- */
            /* Upload an image named 'bg-day.jpg' to GitHub */
            --bg-image: url('bg-day.jpg'); 
            --text-color: #2e4a33; /* Dark Sage Green */
            --glass-bg: rgba(255, 253, 240, 0.7); 
            --font-family: 'Verdana', sans-serif;
        }

        [data-theme="cyber"] {
            /* --- NIGHT THEME (Cyberpunk) --- */
            /* Upload an image named 'bg-night.gif' to GitHub */
            --bg-image: url('bg-night.gif'); 
            --text-color: #00ffcc; /* Cyan */
            --glass-bg: rgba(0, 0, 0, 0.8); 
            --font-family: 'Courier New', monospace;
        }

        /* --- GLOBAL LAYOUT --- */
        body {
            margin: 0; height: 100vh; display: flex;
            justify-content: center; align-items: center;
            font-family: var(--font-family);
            background-image: var(--bg-image);
            background-size: cover; background-position: center;
            transition: all 0.5s ease; overflow: hidden;
        }
        body::before {
            content: ""; position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: inherit; filter: blur(5px); z-index: -2;
        }
        .container {
            background: var(--glass-bg);
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 25px; padding: 40px;
            text-align: center; width: 90%; max-width: 400px;
            color: var(--text-color);
            box-shadow: 0 8px 32px 0 rgba(0,0,0,0.2);
            transition: color 1s ease, background 0.5s ease;
        }
        .header { display: flex; justify-content: space-between; margin-bottom: 20px; }
        button { cursor: pointer; border: none; background: none; color: inherit; font-family: inherit; transition: 0.2s; }
        .theme-toggle, .settings-toggle { font-size: 1.5rem; opacity: 0.8; }
        .theme-toggle:hover, .settings-toggle:hover { transform: scale(1.1); opacity: 1; }
        
        /* TIMER VISUALS */
        .timer-wrapper { position: relative; width: 250px; height: 250px; margin: 0 auto; }
        svg { transform: rotate(-90deg); width: 100%; height: 100%; }
        circle { fill: none; stroke-width: 8; stroke-linecap: round; transition: stroke-dashoffset 1s linear, stroke 1s linear; }
        .track { stroke: rgba(128, 128, 128, 0.3); }
        .progress { stroke: var(--text-color); } 
        
        .time-display {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem; font-weight: bold;
        }

        /* BUTTONS */
        .controls { margin-top: 30px; display: flex; justify-content: center; gap: 15px; }
        button.btn-main {
            padding: 12px 25px; border: 2px solid currentColor;
            font-size: 1rem; border-radius: 50px; text-transform: uppercase; font-weight: bold;
        }
        button.btn-main:hover { background: currentColor; color: var(--glass-bg); }

        .modes { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; }
        .mode-btn { font-size: 0.9rem; padding: 5px 10px; border-radius: 10px; opacity: 0.6; }
        .mode-btn.active { opacity: 1; font-weight: bold; background: rgba(128,128,128,0.2); }

        /* SETTINGS PANEL */
        #settings-panel {
            display: none; margin-top: 20px;
            border-top: 1px solid currentColor; padding-top: 15px;
            font-size: 0.9rem; text-align: left;
        }
        .setting-row { margin: 10px 0; display: flex; justify-content: space-between; align-items: center; }
        input[type="number"] {
            width: 60px; padding: 5px; border-radius: 5px; border: 1px solid currentColor;
            background: rgba(255,255,255,0.2); color: inherit;
        }
        .custom-controls { display: flex; gap: 10px; margin-top: 10px; }
        .btn-custom {
            flex: 1; padding: 8px; background: rgba(128,128,128,0.2);
            border-radius: 8px; font-weight: bold; font-size: 0.8rem;
        }

        .music-player { margin-top: 20px; font-size: 0.8rem; opacity: 0.8; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <button id="theme-btn" class="theme-toggle">üåø</button>
        <button id="settings-btn" class="settings-toggle">‚öôÔ∏è</button>
    </div>

    <div class="modes">
        <button class="mode-btn active" id="mode-pomodoro" data-time="25" data-mode="work">Pomodoro</button>
        <button class="mode-btn" id="mode-short" data-time="5" data-mode="break">Short Break</button>
        <button class="mode-btn" id="mode-long" data-time="15" data-mode="break">Long Break</button>
    </div>

    <div class="timer-wrapper">
        <svg>
            <circle class="track" cx="125" cy="125" r="110"></circle>
            <circle class="progress" cx="125" cy="125" r="110"></circle>
        </svg>
        <div class="time-display" id="time-display">25:00</div>
    </div>

    <div class="controls">
        <button class="btn-main" id="start-btn">Start</button>
        <button class="btn-main" id="reset-btn">Reset</button>
    </div>

    <div id="settings-panel">
        <div class="setting-row">
            <label>Auto-start Breaks?</label>
            <input type="checkbox" id="auto-break">
        </div>
        <div class="setting-row">
            <label>Custom Work (min):</label>
            <input type="number" id="custom-work-input" value="45">
        </div>
        <div class="setting-row">
            <label>Custom Break (min):</label>
            <input type="number" id="custom-break-input" value="10">
        </div>
        <div class="custom-controls">
            <button class="btn-custom" id="start-custom-work">Start Work</button>
            <button class="btn-custom" id="start-custom-break">Start Break</button>
        </div>
    </div>

    <div class="music-player">
        <button id="music-btn">‚ñ∂ Play Lo-Fi</button>
        <audio id="bg-music" loop>
             <source src="https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3?filename=lofi-study-112191.mp3" type="audio/mpeg">
        </audio>
    </div>
</div>

<script>
    /* =========================================
       STEP 2: COLOR FADING CONFIGURATION
       ========================================= */
    const colorsDay = { start: [0, 100, 0], end: [210, 180, 140] }; 
    const colorsNight = { start: [75, 0, 130], end: [255, 20, 147] };

    /* =========================================
       STEP 3: SOUND FILES
       ========================================= */
    const sounds = {
        click: new Audio('click.mp3'),
        alarmDay: new Audio('alarm-day.mp3'),
        alarmNight: new Audio('alarm-night.mp3')
    };

    /* --- LOGIC --- */
    const circle = document.querySelector('.progress');
    const radius = circle.r.baseVal.value;
    const circumference = 2 * Math.PI * radius;
    circle.style.strokeDasharray = `${circumference} ${circumference}`;

    let timeLeft = 25 * 60;
    let totalTime = 25 * 60;
    let timerId = null;
    let isRunning = false;
    let currentMode = 'work'; 
    let targetTime = null;

    const timeDisplay = document.getElementById('time-display');
    const startBtn = document.getElementById('start-btn');
    const html = document.documentElement;

    function interpolateColor(color1, color2, factor) {
        let result = color1.slice();
        for (let i = 0; i < 3; i++) {
            result[i] = Math.round(result[i] + factor * (color2[i] - color1[i]));
        }
        return `rgb(${result[0]}, ${result[1]}, ${result[2]})`;
    }

    function updateVisuals(seconds) {
        const m = Math.floor(seconds / 60);
        const s = seconds % 60;
        timeDisplay.textContent = `${m < 10 ? '0' : ''}${m}:${s < 10 ? '0' : ''}${s}`;
        
        const percent = seconds / totalTime;
        const offset = circumference - (percent * circumference);
        circle.style.strokeDashoffset = offset;

        const isCyber = html.getAttribute('data-theme') === 'cyber';
        const palette = isCyber ? colorsNight : colorsDay;
        const currentColor = interpolateColor(palette.start, palette.end, 1 - percent);
        
        circle.style.stroke = currentColor;
        timeDisplay.style.color = currentColor;
        document.querySelector('.container').style.color = currentColor;
        document.documentElement.style.setProperty('--text-color', currentColor);
    }

    function playSound(type) {
        if(type === 'click') {
            sounds.click.currentTime = 0;
            sounds.click.play().catch(e => {});
        } else if (type === 'alarm') {
            const isCyber = html.getAttribute('data-theme') === 'cyber';
            const alarm = isCyber ? sounds.alarmNight : sounds.alarmDay;
            alarm.play().catch(e => {});
        }
    }

    function highlightMode(mode) {
        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
        if (mode === 'work') document.getElementById('mode-pomodoro').classList.add('active');
        if (mode === 'break') document.getElementById('mode-short').classList.add('active');
        // Custom modes keep current selection or clear
    }

    /* --- THE FIX: SMART SWITCHING LOGIC --- */
    function timerComplete() {
        clearInterval(timerId);
        isRunning = false;
        startBtn.textContent = 'Start';
        targetTime = null;
        localStorage.removeItem('targetTime');
        playSound('alarm');

        const autoBreak = document.getElementById('auto-break').checked;

        // 1. Determine NEXT Step
        if (currentMode === 'work') {
            // Finished Work -> Load Short Break
            setupTimer(5 * 60, 'break');
            highlightMode('break');
            if(autoBreak) setTimeout(() => startTimer(), 1000);

        } else if (currentMode === 'break') {
            // Finished Break -> Load Work
            setupTimer(25 * 60, 'work');
            highlightMode('work');
            // Usually don't auto-start work, but if you want to, uncomment next line:
            // if(autoBreak) setTimeout(() => startTimer(), 1000);

        } else if (currentMode === 'custom-work') {
            // Finished Custom Work -> Load Custom Break
            const breakT = document.getElementById('custom-break-input').value;
            setupTimer(breakT * 60, 'custom-break');
            if(autoBreak) setTimeout(() => startTimer(), 1000);

        } else if (currentMode === 'custom-break') {
            // Finished Custom Break -> Load Custom Work
            const workT = document.getElementById('custom-work-input').value;
            setupTimer(workT * 60, 'custom-work');
        }
    }

    function startTimer() {
        if (isRunning) {
            clearInterval(timerId);
            isRunning = false;
            startBtn.textContent = 'Start';
            targetTime = null;
            localStorage.removeItem('targetTime');
        } else {
            isRunning = true;
            startBtn.textContent = 'Pause';
            targetTime = Date.now() + (timeLeft * 1000);
            localStorage.setItem('targetTime', targetTime);
            
            timerId = setInterval(() => {
                const now = Date.now();
                const distance = targetTime - now;
                if (distance < 0) {
                    timeLeft = 0;
                    updateVisuals(0);
                    timerComplete();
                } else {
                    timeLeft = Math.ceil(distance / 1000);
                    updateVisuals(timeLeft);
                }
            }, 1000);
        }
    }

    function setupTimer(seconds, mode) {
        clearInterval(timerId);
        isRunning = false;
        startBtn.textContent = 'Start';
        timeLeft = seconds;
        totalTime = seconds;
        currentMode = mode;
        targetTime = null;
        localStorage.removeItem('targetTime');
        updateVisuals(seconds);
    }

    /* --- LISTENERS --- */
    document.getElementById('start-btn').addEventListener('click', () => { playSound('click'); startTimer(); });
    document.getElementById('reset-btn').addEventListener('click', () => { playSound('click'); setupTimer(totalTime, currentMode); });

    document.querySelectorAll('.mode-btn[data-time]').forEach(btn => {
        btn.addEventListener('click', () => {
            playSound('click');
            highlightMode(btn.dataset.mode === 'work' ? 'work' : 'break');
            // Specific override for Long Break button
            if(btn.id === 'mode-long') {
                 document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                 btn.classList.add('active');
            }
            setupTimer(btn.dataset.time * 60, btn.dataset.mode);
        });
    });

    document.getElementById('start-custom-work').addEventListener('click', () => {
        playSound('click');
        const min = document.getElementById('custom-work-input').value;
        document.getElementById('settings-panel').style.display = 'none';
        highlightMode(''); // clear selection
        setupTimer(min * 60, 'custom-work');
    });

    document.getElementById('start-custom-break').addEventListener('click', () => {
        playSound('click');
        const min = document.getElementById('custom-break-input').value;
        document.getElementById('settings-panel').style.display = 'none';
        highlightMode('');
        setupTimer(min * 60, 'custom-break');
    });

    document.getElementById('theme-btn').addEventListener('click', (e) => {
        playSound('click');
        if (html.getAttribute('data-theme') === 'cyber') {
            html.removeAttribute('data-theme');
            e.target.textContent = 'üåø';
        } else {
            html.setAttribute('data-theme', 'cyber');
            e.target.textContent = 'üëæ';
        }
        updateVisuals(timeLeft);
    });

    document.getElementById('settings-btn').addEventListener('click', () => {
        playSound('click');
        const panel = document.getElementById('settings-panel');
        panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
    });

    const musicBtn = document.getElementById('music-btn');
    const bgMusic = document.getElementById('bg-music');
    let isMusicPlaying = false;
    musicBtn.addEventListener('click', () => {
        playSound('click');
        if(isMusicPlaying) { bgMusic.pause(); musicBtn.textContent = '‚ñ∂ Play Lo-Fi'; } 
        else { bgMusic.play(); musicBtn.textContent = '‚è∏ Pause'; }
        isMusicPlaying = !isMusicPlaying;
    });

    const savedTarget = localStorage.getItem('targetTime');
    if (savedTarget) {
        const now = Date.now();
        if (savedTarget > now) {
            targetTime = parseInt(savedTarget);
            timeLeft = Math.ceil((targetTime - now) / 1000);
            startTimer();
        }
    }
    
    updateVisuals(timeLeft);
</script>
</body>
</html>
