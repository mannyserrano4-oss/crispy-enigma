<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAS Design Engine | Zoom Preview</title>
    <script src="https://cdn.jsdelivr.net/npm/imagetracerjs@1.2.6/imagetracer_v1.2.6.min.js"></script>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --text: #f8fafc; --accent: #38bdf8; --border: #334155; }
        body { background: var(--bg); color: var(--text); font-family: -apple-system, sans-serif; margin: 0; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        .container { width: 100%; max-width: 800px; background: var(--card); padding: 20px; border-radius: 16px; border: 1px solid var(--border); box-shadow: 0 10px 25px rgba(0,0,0,0.5); }
        
        /* Upload Area */
        .drop-zone { border: 2px dashed var(--accent); border-radius: 12px; padding: 30px; text-align: center; cursor: pointer; background: rgba(56, 189, 248, 0.05); margin-bottom: 20px; }
        
        /* Preview Controls */
        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .control-group { display: flex; flex-direction: column; gap: 5px; font-size: 0.8rem; font-weight: bold; color: var(--accent); }
        select, button, input[type="range"] { padding: 10px; border-radius: 8px; border: 1px solid var(--border); background: #0f172a; color: white; font-size: 1rem; }
        button { background: var(--accent); color: #0f172a; border: none; font-weight: bold; cursor: pointer; }

        /* Zoom Preview Window */
        .preview-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .preview-window { 
            width: 100%; 
            aspect-ratio: 1/1; 
            background: #000; 
            border: 2px solid var(--border); 
            border-radius: 12px; 
            position: relative; 
            overflow: hidden; /* This hides the parts of the image that go outside the box when zooming */
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: move;
        }

        #zoom-container {
            transition: transform 0.1s ease-out;
            transform-origin: center;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
        }

        svg, canvas { max-width: 100%; max-height: 100%; display: block; }
        
        .status { font-size: 0.8rem; color: #94a3b8; text-align: center; margin-top: 15px; }
        #loading { display: none; color: var(--accent); font-weight: bold; }
    </style>
</head>
<body>

    <div class="container">
        <h2 style="text-align:center; margin: 0 0 15px 0;">MAS Design Engine</h2>
        
        <div class="drop-zone" id="drop-zone">
            <span>Tap to Upload Logo or Design</span>
            <input type="file" id="file-input" accept="image/*" hidden>
        </div>

        <div class="controls">
            <div class="control-group">
                <label>Format</label>
                <select id="format">
                    <option value="image/svg+xml">SVG (Vector)</option>
                    <option value="image/png">PNG</option>
                    <option value="image/jpeg">JPEG</option>
                </select>
            </div>
            <div class="control-group">
                <label>Magnify (Zoom): <span id="zoom-val">1x</span></label>
                <input type="range" id="zoom-slider" min="1" max="10" step="0.1" value="1">
            </div>
        </div>

        <div class="preview-header">
            <span id="loading">CONVERTING...</span>
            <span style="font-size: 0.7rem; color: #888;">Inspect edges below before download</span>
        </div>

        <div class="preview-window" id="window">
            <div id="zoom-container">
                </div>
        </div>

        <button id="download-btn" style="width:100%; margin-top: 20px; display:none;">Download Final File</button>
        <div class="status" id="status">Waiting for image...</div>
    </div>

    <script>
        const fileInput = document.getElementById('file-input');
        const dropZone = document.getElementById('drop-zone');
        const formatSelect = document.getElementById('format');
        const zoomSlider = document.getElementById('zoom-slider');
        const zoomVal = document.getElementById('zoom-val');
        const zoomContainer = document.getElementById('zoom-container');
        const downloadBtn = document.getElementById('download-btn');
        const status = document.getElementById('status');
        const loading = document.getElementById('loading');
        
        let originalImg = null;
        let hiddenCanvas = document.createElement('canvas');
        let hCtx = hiddenCanvas.getContext('2d');

        // 1. Zoom Logic
        zoomSlider.oninput = () => {
            const scale = zoomSlider.value;
            zoomVal.innerText = `${scale}x`;
            zoomContainer.style.transform = `scale(${scale})`;
        };

        // 2. File Handling
        dropZone.onclick = () => fileInput.click();
        fileInput.onchange = (e) => handleFile(e.target.files[0]);

        function handleFile(file) {
            if (!file) return;
            status.innerText = `File: ${file.name}`;
            const reader = new FileReader();
            reader.onload = (e) => {
                originalImg = new Image();
                originalImg.onload = processFile;
                originalImg.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        // 3. Conversion Engine
        async function processFile() {
            loading.style.display = 'inline';
            downloadBtn.style.display = 'none';
            zoomSlider.value = 1;
            zoomVal.innerText = '1x';
            zoomContainer.style.transform = 'scale(1)';
            
            // Limit internal resolution for stability on iPhone
            const max = 1000;
            let w = originalImg.width, h = originalImg.height;
            if (w > max || h > max) {
                const r = Math.min(max/w, max/h);
                w *= r; h *= r;
            }
            hiddenCanvas.width = w; hiddenCanvas.height = h;
            hCtx.drawImage(originalImg, 0, 0, w, h);

            setTimeout(() => {
                const target = formatSelect.value;
                zoomContainer.innerHTML = '';

                if (target === "image/svg+xml") {
                    const options = { ltres: 1, qtres: 1, pathomit: 10, numberofcolors: 16 };
                    const svgString = ImageTracer.imagedataToSVG(hCtx.getImageData(0,0,w,h), options);
                    zoomContainer.innerHTML = svgString;
                } else {
                    const img = document.createElement('img');
                    img.src = hiddenCanvas.toDataURL(target, 0.9);
                    img.style.width = '100%';
                    zoomContainer.appendChild(img);
                }

                loading.style.display = 'none';
                downloadBtn.style.display = 'block';
            }, 100);
        }

        formatSelect.onchange = () => { if(originalImg) processFile(); };

        // 4. Download Logic
        downloadBtn.onclick = () => {
            const target = formatSelect.value;
            const a = document.createElement('a');
            
            if (target === "image/svg+xml") {
                const blob = new Blob([zoomContainer.innerHTML], {type: 'image/svg+xml'});
                a.href = URL.createObjectURL(blob);
                a.download = 'MAS-Converted.svg';
            } else {
                a.href = hiddenCanvas.toDataURL(target, 0.9);
                a.download = `MAS-Converted.${target.split('/')[1]}`;
            }
            a.click();
        };
    </script>
</body>
</html>
