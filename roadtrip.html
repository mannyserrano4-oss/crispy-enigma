<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>Road Trip Hub</title>
    <meta name="apple-mobile-web-app-title" content="Road Trip Hub">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="apple-touch-icon" href="car.png">
    <link rel="icon" type="image/png" href="car.png">

    <style>
        :root {
            /* --- DARK MODE (DEFAULT) --- */
            --bg-main: #121212;
            --surface: #1e1e1e;
            --text-main: #ffffff;
            --text-sub: #aaaaaa;
            
            --primary: #bb86fc;
            --secondary: #03dac6;
            --error: #cf6679;
            
            --border: #333333;
            --shadow: rgba(0,0,0,0.5);
            
            --bingo-tile: #2d3436;
            --bingo-mark: #4cd137;
            --bingo-text: #ffffff;
        }

        /* --- LIGHT MODE OVERRIDES --- */
        body.light-mode {
            --bg-main: #f0f2f5;
            --surface: #ffffff;
            --text-main: #121212;
            --text-sub: #555555;
            
            --primary: #6200ee;
            --secondary: #018786;
            --error: #b00020;
            
            --border: #e0e0e0;
            --shadow: rgba(0,0,0,0.1);
            
            --bingo-tile: #ffffff;
            --bingo-mark: #00b894; /* Slightly darker green for contrast */
            --bingo-text: #121212;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-main);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            /* Dynamic Viewport Height for mobile */
            height: 100vh;
            height: 100dvh; 
            overflow: hidden;
            display: flex;
            flex-direction: column;
            user-select: none;
            -webkit-user-select: none;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* --- NAVIGATION --- */
        .screen {
            display: none;
            flex-direction: column;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0; left: 0;
            background: var(--bg-main);
            overflow: hidden;
            transition: background-color 0.3s ease;
        }
        .screen.active { display: flex; }

        .nav-header {
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(125, 125, 125, 0.05); /* See-through tint */
            border-bottom: 1px solid var(--border);
            z-index: 10;
            flex-shrink: 0;
        }

        .icon-btn {
            background: none; 
            border: none; 
            font-size: 1.5rem; 
            cursor: pointer; 
            padding: 5px;
            color: var(--text-main);
            border-radius: 8px;
        }
        
        .icon-btn:active { background-color: rgba(125,125,125,0.2); }

        .screen-title { 
            font-size: 1.2rem; 
            font-weight: 800; 
            text-transform: uppercase; 
            letter-spacing: 2px; 
            color: var(--secondary); 
            margin: 0; 
        }

        /* --- HOME SCREEN --- */
        #screen-home {
            justify-content: flex-start;
            align-items: center;
            padding: 20px;
            gap: 20px;
            overflow-y: auto;
        }
        
        .home-header-row {
            width: 100%;
            max-width: 350px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .menu-card {
            background: var(--surface);
            width: 100%;
            max-width: 350px;
            padding: 25px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            gap: 20px;
            cursor: pointer;
            border: 1px solid var(--border);
            box-shadow: 0 4px 10px var(--shadow);
            transition: transform 0.1s;
        }
        .menu-card:active { transform: scale(0.98); opacity: 0.8; }

        .menu-icon { font-size: 2.5rem; }
        .menu-info h2 { margin: 0; font-size: 1.4rem; color: var(--text-main); }
        .menu-info p { margin: 5px 0 0 0; color: var(--text-sub); font-size: 0.9rem; }

        /* --- GAME 1: DEEP DIVE --- */
        #screen-dive { 
            align-items: center; 
            justify-content: space-between; 
            padding-bottom: 20px; 
        }

        .category-scroll {
            display: flex;
            gap: 10px;
            padding: 15px;
            overflow-x: auto;
            width: 100%;
            box-sizing: border-box;
            flex-shrink: 0;
            background: var(--bg-main);
        }

        .cat-chip {
            background: var(--surface);
            color: var(--text-sub);
            padding: 8px 16px;
            border-radius: 20px;
            white-space: nowrap;
            font-size: 0.9rem;
            border: 1px solid var(--border);
            cursor: pointer;
        }
        .cat-chip.active { background: var(--primary); color: white; border-color: var(--primary); font-weight: bold; }

        .card-container {
            flex-grow: 1;
            width: 90%;
            max-width: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            perspective: 1000px;
            min-height: 0; 
            padding: 10px 0;
        }

        .question-card {
            background: var(--surface);
            width: 100%;
            height: 100%;
            max-height: 350px;
            border-radius: 20px;
            padding: 30px;
            box-sizing: border-box;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            line-height: 1.4;
            color: var(--text-main);
            border: 1px solid var(--border);
            box-shadow: 0 10px 30px var(--shadow);
            transition: transform 0.3s;
            overflow-y: auto;
        }

        .controls-dive {
            display: flex;
            gap: 20px;
            width: 90%;
            max-width: 400px;
            flex-shrink: 0;
            padding-bottom: env(safe-area-inset-bottom);
        }

        .action-btn {
            flex: 1;
            padding: 20px;
            border-radius: 12px;
            border: none;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            box-shadow: 0 4px 0 rgba(0,0,0,0.1);
        }
        
        .btn-pass { 
            background: var(--surface); 
            color: var(--error); 
            border: 2px solid var(--error); 
        }
        .btn-next { 
            background: var(--secondary); 
            color: #000; /* Always black text on teal button for contrast */
        }
        .action-btn:active { transform: translateY(2px); box-shadow: none; }

        /* --- GAME 2: THE PITCH --- */
        #screen-pitch { padding: 20px; align-items: center; overflow-y: auto; }

        .pitch-box {
            background: var(--surface);
            width: 100%;
            max-width: 400px;
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 10px;
            border: 1px solid var(--border);
        }

        .pitch-label { color: var(--text-sub); font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; }
        .pitch-content { font-size: 1.2rem; font-weight: bold; color: var(--text-main); min-height: 1.4em;}

        .timer-display {
            font-size: 4rem;
            font-weight: 900;
            color: var(--primary);
            margin: 10px 0;
            font-variant-numeric: tabular-nums;
        }

        .pitch-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            max-width: 400px;
            padding-bottom: 40px;
        }
        
        .btn-dark {
            background: var(--surface);
            color: var(--text-main);
            border: 1px solid var(--border);
        }

        /* --- GAME 3: BINGO --- */
        #screen-bingo { justify-content: center; }

        .bingo-wrapper {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
            width: 100%;
        }

        #bingo-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: 4px;
            width: 100%;
            max-width: 500px;
            aspect-ratio: 1/1; 
        }

        .bingo-tile {
            background: var(--bingo-tile);
            color: var(--bingo-text);
            border: 1px solid var(--border);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 0.7rem;
            line-height: 1.1;
            font-weight: 600;
            padding: 2px;
            cursor: pointer;
            overflow: hidden;
            user-select: none;
            box-shadow: 0 2px 0 var(--shadow);
        }

        .bingo-tile.marked { 
            background: var(--bingo-mark); 
            color: white; 
            border-color: var(--bingo-mark); 
            font-weight: bold; 
        }
        .bingo-tile.free { 
            background: var(--primary); 
            color: white; 
            border-color: var(--primary);
        }

        /* --- OVERLAYS --- */
        #overlay {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: var(--surface);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            border: 4px solid var(--secondary);
            z-index: 100;
            transition: transform 0.2s;
            width: 80%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        #overlay.visible { transform: translate(-50%, -50%) scale(1); }
        .overlay-text { font-size: 2.5rem; color: var(--secondary); margin: 0 0 10px 0; font-weight: 900; }

        #confetti-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 90; }

        @media (max-height: 700px) {
            .question-card { font-size: 1.2rem; }
            .bingo-tile { font-size: 0.6rem; }
        }

    </style>
</head>
<body>

    <canvas id="confetti-canvas"></canvas>

    <div id="screen-home" class="screen active">
        <div class="home-header-row">
            <h1 style="font-size: 1.8rem; margin: 0; color: var(--primary); font-weight: 900;">ROAD TRIP HUB</h1>
            <button class="icon-btn" onclick="toggleTheme()" id="theme-btn-home">üåô</button>
        </div>
        
        <div class="menu-card" onclick="navTo('dive')">
            <div class="menu-icon">üí¨</div>
            <div class="menu-info">
                <h2>Deep Dive</h2>
                <p>160+ Conversation starters</p>
            </div>
        </div>

        <div class="menu-card" onclick="navTo('pitch')">
            <div class="menu-icon">üé¨</div>
            <div class="menu-info">
                <h2>The Pitch</h2>
                <p>180k+ Movie ideas</p>
            </div>
        </div>

        <div class="menu-card" onclick="navTo('bingo')">
            <div class="menu-icon">üõ£Ô∏è</div>
            <div class="menu-info">
                <h2>Highway Bingo</h2>
                <p>150+ Road trip items</p>
            </div>
        </div>
    </div>

    <div id="screen-dive" class="screen">
        <div class="nav-header">
            <button class="icon-btn" onclick="navTo('home')">üè†</button>
            <div class="screen-title">Deep Dive</div>
            <button class="icon-btn" onclick="toggleTheme()">üåì</button>
        </div>

        <div class="category-scroll">
            <div class="cat-chip active" onclick="setCategory('all', this)">All</div>
            <div class="cat-chip" onclick="setCategory('fun', this)">Fun</div>
            <div class="cat-chip" onclick="setCategory('deep', this)">Deep</div>
            <div class="cat-chip" onclick="setCategory('spicy', this)">Spicy</div>
            <div class="cat-chip" onclick="setCategory('retro', this)">Nostalgia</div>
        </div>

        <div class="card-container">
            <div id="question-text" class="question-card">
                Tap Next to Start
            </div>
        </div>

        <div class="controls-dive">
            <button class="action-btn btn-pass" onclick="passQuestion()">üêî Pass</button>
            <button class="action-btn btn-next" onclick="nextQuestion()">Next ‚ûî</button>
        </div>
    </div>

    <div id="screen-pitch" class="screen">
        <div class="nav-header">
            <button class="icon-btn" onclick="navTo('home')">üè†</button>
            <div class="screen-title">The Pitch</div>
            <button class="icon-btn" onclick="toggleTheme()">üåì</button>
        </div>

        <div style="flex-grow: 1; width: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center;">
            <div class="pitch-box">
                <div class="pitch-label">Genre</div>
                <div class="pitch-content" id="pitch-genre">---</div>
            </div>
            <div class="pitch-box">
                <div class="pitch-label">Protagonist</div>
                <div class="pitch-content" id="pitch-hero">---</div>
            </div>
            <div class="pitch-box">
                <div class="pitch-label">The Twist</div>
                <div class="pitch-content" id="pitch-twist">---</div>
            </div>

            <div class="timer-display" id="pitch-timer">60</div>

            <div class="pitch-controls">
                <button class="action-btn btn-next" onclick="generatePitch()">Generate New Movie</button>
                <button class="action-btn btn-dark" onclick="startPitchTimer()">Start Timer</button>
            </div>
        </div>
    </div>

    <div id="screen-bingo" class="screen">
        <div class="nav-header">
            <button class="icon-btn" onclick="navTo('home')">üè†</button>
            <div class="screen-title">Bingo</div>
            <div style="display: flex; gap: 10px;">
                <button class="icon-btn" onclick="toggleTheme()">üåì</button>
                <button class="icon-btn" style="font-size: 1rem; border: 1px solid var(--border); padding: 5px 10px;" onclick="newBingoGame()">NEW</button>
            </div>
        </div>

        <div class="bingo-wrapper">
            <div id="bingo-grid"></div>
        </div>
    </div>

    <div id="overlay" onclick="this.classList.remove('visible')">
        <div class="overlay-text">BINGO!</div>
        <div style="color: var(--text-main);">Tap to continue</div>
    </div>

    <script>
        // --- THEME ENGINE ---
        function initTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'light') {
                document.body.classList.add('light-mode');
                document.getElementById('theme-btn-home').innerText = '‚òÄÔ∏è';
            } else {
                document.getElementById('theme-btn-home').innerText = 'üåô';
            }
        }

        function toggleTheme() {
            document.body.classList.toggle('light-mode');
            const isLight = document.body.classList.contains('light-mode');
            localStorage.setItem('theme', isLight ? 'light' : 'dark');
            
            // Update Home Icon
            document.getElementById('theme-btn-home').innerText = isLight ? '‚òÄÔ∏è' : 'üåô';
        }

        // --- AUDIO ENGINE ---
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();

        document.addEventListener('touchstart', unlockAudio, { once: true });
        document.addEventListener('click', unlockAudio, { once: true });

        function unlockAudio() { if (audioCtx.state === 'suspended') audioCtx.resume(); }

        function playSound(type) {
            unlockAudio();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            const now = audioCtx.currentTime;

            if (type === 'pop') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(600, now);
                osc.frequency.exponentialRampToValueAtTime(100, now + 0.1);
                gain.gain.setValueAtTime(0.5, now);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
                osc.start(now); osc.stop(now + 0.1);
            } else if (type === 'unpop') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(300, now);
                gain.gain.setValueAtTime(0.3, now);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
                osc.start(now); osc.stop(now + 0.1);
            } else if (type === 'swipe') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(300, now);
                osc.frequency.exponentialRampToValueAtTime(100, now + 0.1);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
                osc.start(now); osc.stop(now + 0.1);
            } else if (type === 'chicken') {
                const cluck = (t) => {
                    const o = audioCtx.createOscillator();
                    const g = audioCtx.createGain();
                    o.connect(g); g.connect(audioCtx.destination);
                    o.type = 'square';
                    o.frequency.setValueAtTime(400, t);
                    o.frequency.exponentialRampToValueAtTime(300, t+0.1);
                    g.gain.setValueAtTime(0.2, t);
                    g.gain.exponentialRampToValueAtTime(0.001, t+0.1);
                    o.start(t); o.stop(t+0.1);
                };
                cluck(now); cluck(now+0.15); cluck(now+0.3);
            } else if (type === 'alarm') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(800, now);
                osc.frequency.linearRampToValueAtTime(600, now+0.3);
                gain.gain.setValueAtTime(0.2, now);
                gain.gain.linearRampToValueAtTime(0, now+0.3);
                osc.start(now); osc.stop(now+0.3);
            } else if (type === 'win') {
                [523, 659, 783, 1046].forEach((f, i) => {
                    const o = audioCtx.createOscillator();
                    const g = audioCtx.createGain();
                    o.connect(g); g.connect(audioCtx.destination);
                    o.type = 'triangle';
                    o.frequency.value = f;
                    g.gain.setValueAtTime(0.1, now + i*0.1);
                    g.gain.exponentialRampToValueAtTime(0.001, now + i*0.1 + 0.5);
                    o.start(now + i*0.1); o.stop(now + i*0.1 + 0.5);
                });
            }
        }

        // --- NAVIGATION ---
        function navTo(screenId) {
            playSound('swipe');
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(`screen-${screenId}`).classList.add('active');
            
            if(screenId === 'bingo' && document.getElementById('bingo-grid').children.length === 0) newBingoGame();
            if(screenId === 'pitch' && document.getElementById('pitch-hero').innerText === '---') generatePitch();
        }

        // --- DATA ---
        const questionsDB = {
            fun: ["Best concert you've ever been to?", "What's the weirdest food you like?", "If you could instantly learn any skill, what would it be?", "Which movie character is basically you?", "If you had to start a cult, what would it be about?", "What‚Äôs the most useless talent you have?", "If animals could talk, which would be the rudest?", "What would your wrestling name and finishing move be?", "What‚Äôs the worst haircut you‚Äôve ever had?", "If you were a ghost, who would you haunt?", "What's the dumbest way you've injured yourself?", "If you could have an unlimited supply of one thing, what would it be?", "What song would be your entrance theme?", "Who would play you in a movie?", "What trend do you hope never comes back?", "Strangest gift you've ever received?", "Go-to karaoke song?", "If you had to live in a video game, which one?", "Best prank you've pulled?", "Funniest wifi name you've seen?", "Zombie apocalypse plan?", "If you won the lottery, what's the first dumb thing you'd buy?", "Most boring sport?", "If you were an ice cream flavor, what would you be?", "Movie everyone loves but you hate?", "Weirdest thing in your fridge?", "Swap lives with anyone for a day?", "Spirit animal?", "Most embarrassing thing you own?", "Rename yourself?", "Worst job imaginable?", "One food forever?", "Superstition you believe?", "Funniest person you know?", "Best compliment received?", "What would you be famous for?", "Favorite dad joke?", "Un-invent one thing?", "Weirdest dream you remember?", "Best Halloween costume?"],
            deep: ["What is your biggest fear that you rarely admit?", "What‚Äôs one thing you‚Äôd change about your past?", "What does a perfect day look like to you?", "Who has influenced you the most in life?", "What is the hardest lesson you‚Äôve had to learn?", "When did you last cry and why?", "What is something you are struggling with right now?", "What do you want to be remembered for?", "What is your definition of success?", "If you knew you couldn‚Äôt fail, what would you do?", "Dream you've let go of?", "Who do you wish you were closer to?", "Best advice received?", "Most grateful for?", "Regret if you died tomorrow?", "One thing you love about yourself?", "Habit you wish to break?", "What makes you feel alive?", "What happens after we die?", "Question for God?", "Biggest risk taken?", "Moment you felt most proud?", "Memory you hope to never forget?", "Thing you've forgiven yourself for?", "Value most in friendship?", "Wish you knew 10 years ago?", "Biggest misconception about you?", "Love language?", "Change one thing about the world?", "What keeps you up at night?", "Relationship breaker?", "Who do you look up to?", "What makes a house a home?", "Biggest insecurity?", "Letter to younger self?", "Kindest thing done for you?", "Most passionate about?", "How do you handle stress?", "Book/Movie that changed your life?", "Meaning of happiness?"],
            spicy: ["What's a secret you've kept from your parents?", "Worst date you've ever been on?", "What is an unpopular opinion you hold?", "Have you ever ghosted someone and why?", "What is the pettiest thing you‚Äôve ever done?", "Have you ever cheated on anything?", "What‚Äôs a lie you‚Äôve told that got out of hand?", "Who in this car would survive the longest in prison?", "What‚Äôs the most illegal thing you‚Äôve done?", "Have you ever snooped through a partner's phone?", "Biggest turn-off?", "Worst text sent to wrong person?", "Crush on friend's partner?", "Rumor you started?", "Worst kiss?", "Most expensive thing broken?", "Ever stolen anything?", "Meanest thing said?", "Celebrity hall pass?", "Habit that annoys others?", "Ever been fired?", "Toxic trait?", "Peed in a pool?", "Worst driver in car?", "Judge people for?", "Fist fight?", "Embarrassing drunk moment?", "Lied to get out of date?", "Guilty pleasure?", "Stalked ex online?", "Worst polite food?", "Re-gifted?", "Likely to get arrested?", "Worst advice given?", "Faked sick?", "Cringiest online post?", "Broken bone stupidly?", "Secret about someone else?", "Caught in a lie?", "Wildest hookup place?"],
            retro: ["First album you ever bought?", "Favorite childhood cartoon?", "What was your first car?", "Best toy from the 90s/00s?", "What was your favorite school lunch?", "First movie you saw in theaters?", "What was your AIM/MSN screen name?", "What poster was on your bedroom wall?", "First concert you attended?", "Favorite candy growing up?", "Favorite playground game?", "Did you collect anything?", "First cell phone?", "Favorite video game?", "Fashion trend regret?", "Childhood celebrity crush?", "TV show intro you can sing?", "Favorite board game?", "Tamagotchi?", "First website visited?", "Favorite book series?", "Halloween costume?", "Burned CDs?", "Curfew?", "Favorite cereal?", "Blockbuster section?", "Slang used too much?", "Favorite field trip?", "Myspace song?", "Arcade game?", "Favorite teacher?", "Commercial jingle?", "Walkman/Discman?", "Summer activity?", "Scared you as kid?", "Pass notes?", "Ice cream truck treat?", "Treehouse?", "First R-rated movie?", "Favorite memory?"]
        };

        let decks = { fun: [...questionsDB.fun], deep: [...questionsDB.deep], spicy: [...questionsDB.spicy], retro: [...questionsDB.retro] };
        let currentCat = 'all';

        const pitchData = {
            genres: ["Horror", "RomCom", "Sci-Fi", "Western", "Musical", "Action", "Documentary", "Fantasy", "Cyberpunk", "Noir", "Teen Drama", "Holiday Movie", "Sports Drama", "Buddy Cop", "Heist", "Zombie Apocalypse", "Courtroom Drama", "Silent Film", "Anime", "Soap Opera", "Mockumentary", "Slasher", "Time Travel", "War Epic", "Spy Thriller", "Cooking Show", "Reality TV", "Superhero", "Disaster Movie", "Period Piece", "Space Opera", "Vampire Romance", "Kung Fu", "Legal Thriller", "Political Satire", "Found Footage", "Biopic", "Coming of Age", "Psychological Thriller", "Monster Movie", "Musical Biopic", "Christmas Horror", "Stoner Comedy", "Road Trip", "Murder Mystery", "Erotic Thriller", "Stop Motion", "Bollywood", "Surrealist Art Film"],
            heroes: ["A washed-up clown", "A sentient toaster", "Elon Musk's clone", "A distracted Uber driver", "A tired kindergarten teacher", "A time-traveling dog", "A vegan vampire", "A retired hitman", "A ghost who is afraid of people", "A corrupt politician", "A delusional influencer", "A barista with a dark secret", "A cat who thinks it's God", "A clumsy ninja", "A robot who wants to be a chef", "A dissatisfied alien tourist", "A pirate with motion sickness", "A nervous bomb disposal expert", "A disgruntled Santa Claus", "A mime who can't stop talking", "A teenage witch", "A professional cuddler", "A cynical wedding planner", "A disgraced astronaut", "A lottery winner who lost the ticket", "A conspiracy theorist", "A grumpy librarian", "A reckless taxi driver", "A struggling soundcloud rapper", "A man who is allergic to everything", "A woman who can hear plants", "A detective who is always wrong", "A super soldier with amnesia", "A divorced dad", "A Karen", "A yoga instructor", "A disgruntled IT guy", "A bus driver", "A reality TV star", "A failed magician", "A sentient AI", "A talking sword", "A shapeshifter", "A weary god", "A pizza delivery guy", "A bored grim reaper", "A park ranger", "A cruise ship captain", "A wedding DJ", "A blind sniper", "A motivational speaker", "A used car salesman"],
            twists: ["It was all a simulation", "The dog is the mastermind", "They are actually ghosts", "The villain is their future self", "The world ends in 24 hours", "They fall in love", "It was a musical all along", "Everyone is a robot", "It takes place in a microscopic world", "The narrator is lying", "They are trapped in a time loop", "Gravity stops working", "The hero dies in the first 5 minutes", "Aliens invade halfway through", "It was a dream within a dream", "The main character doesn't exist", "The audience is the killer", "Animals start talking", "The sun explodes", "They switch bodies", "It's a prequel to Shrek", "They realize they are in a movie", "The villain is the hero's dad", "Magic is real", "Zombies show up", "The car is alive", "They win the lottery but lose the ticket", "It's a cooking competition", "They are all in purgatory", "The weapon is love", "The bomb is made of chocolate", "Everyone is blind", "The ocean dries up", "The internet becomes sentient", "Plants take over", "Time flows backwards", "They are shrunken down", "It's actually a commercial", "The sidekick is the chosen one", "They can't stop dancing", "Silence kills", "Looking at the sky makes you crazy", "Water turns to wine", "Dinosaurs return", "The moon falls", "Shadows come to life", "The protagonist is the villain", "They are stuck in an elevator", "Someone is an imposter", "The floor is lava", "They have to sing to survive", "Only the dog survives"]
        };

        const bingoItems = [
            "Police Car", "Ambulance", "Fire Truck", "Motorcycle", "Yellow Car", "Pink Car", "Classic Car", "Convertible", "Tesla", "Jeep w/ Ducks",
            "VW Beetle", "Smart Car", "Hummer", "Stick Family", "School Bus", "RV / Motorhome", "Boat on Trailer", "FedEx Truck", "UPS Truck", "Amazon Van",
            "Walmart Truck", "Gas Tanker", "Car Carrier", "Cement Mixer", "Garbage Truck", "U-Haul", "Dog Head out Window", "Feet on Dash", "Driver Singing",
            "Someone Sleeping", "Waffle House", "Cracker Barrel", "Buc-ee's", "McDonald's", "Starbucks", "Dollar General", "Billboard: Lawyer", "Billboard: Jesus",
            "Billboard: Adult", "Speed Limit 70", "State Line", "Rest Area", "Weigh Station", "Exit 69", "Exit 420", "Construction", "Water Tower", "Cell Tower Tree",
            "Wind Turbine", "Solar Farm", "Cows", "Horses", "Roadkill", "Train", "Bridge", "Tunnel", "Airplane", "Out of State Plate", "Vanity Plate", "Student Driver",
            "Baby on Board", "Broken Taillight", "Missing Hubcap", "Spare Tire", "Very Muddy Truck", "Roof Rack", "Bicycles", "Mattress on Roof"
        ];

        // --- GAME 1: DEEP DIVE ---
        function setCategory(cat, el) {
            currentCat = cat;
            document.querySelectorAll('.cat-chip').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            playSound('swipe');
        }

        function nextQuestion() {
            playSound('swipe');
            let poolName = currentCat;
            if (currentCat === 'all') {
                const cats = ['fun', 'deep', 'spicy', 'retro'];
                poolName = cats[Math.floor(Math.random() * cats.length)];
            }
            if (decks[poolName].length === 0) decks[poolName] = [...questionsDB[poolName]];
            const index = Math.floor(Math.random() * decks[poolName].length);
            const q = decks[poolName][index];
            decks[poolName].splice(index, 1);
            
            const card = document.getElementById('question-text');
            card.style.transform = "scale(0.9)";
            setTimeout(() => {
                card.innerText = q;
                card.style.transform = "scale(1)";
            }, 100);
        }

        function passQuestion() {
            playSound('chicken');
            document.getElementById('question-text').innerText = "üêî CHICKEN! üêî";
        }

        // --- GAME 2: THE PITCH ---
        let pitchTimer = null;
        function generatePitch() {
            playSound('swipe');
            clearInterval(pitchTimer);
            document.getElementById('pitch-timer').innerText = "60";
            document.getElementById('pitch-timer').style.color = "var(--primary)";
            document.getElementById('pitch-genre').innerText = pitchData.genres[Math.floor(Math.random() * pitchData.genres.length)];
            document.getElementById('pitch-hero').innerText = pitchData.heroes[Math.floor(Math.random() * pitchData.heroes.length)];
            document.getElementById('pitch-twist').innerText = pitchData.twists[Math.floor(Math.random() * pitchData.twists.length)];
        }

        function startPitchTimer() {
            playSound('swipe');
            clearInterval(pitchTimer);
            let time = 60;
            const display = document.getElementById('pitch-timer');
            pitchTimer = setInterval(() => {
                time--;
                display.innerText = time;
                if(time <= 10) display.style.color = "var(--error)"; 
                if(time <= 0) {
                    clearInterval(pitchTimer);
                    playSound('alarm');
                    display.innerText = "TIME!";
                }
            }, 1000);
        }

        // --- GAME 3: BINGO ---
        let markedIndices = [];
        function newBingoGame() {
            playSound('swipe');
            let deck = [...bingoItems];
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            const selected = deck.slice(0, 24);
            selected.splice(12, 0, "FREE SPACE");
            markedIndices = [12];
            renderBingo(selected);
        }

        function renderBingo(items) {
            const grid = document.getElementById('bingo-grid');
            grid.innerHTML = '';
            items.forEach((item, index) => {
                const tile = document.createElement('div');
                tile.className = 'bingo-tile';
                tile.innerText = item;
                if(index === 12) tile.classList.add('free', 'marked');
                tile.onclick = () => {
                    if(index === 12) return;
                    if(markedIndices.includes(index)) {
                        markedIndices = markedIndices.filter(i => i !== index);
                        tile.classList.remove('marked');
                        playSound('unpop');
                    } else {
                        markedIndices.push(index);
                        tile.classList.add('marked');
                        playSound('pop');
                        checkBingo();
                    }
                };
                grid.appendChild(tile);
            });
        }

        function checkBingo() {
            const wins = [
                [0,1,2,3,4], [5,6,7,8,9], [10,11,12,13,14], [15,16,17,18,19], [20,21,22,23,24],
                [0,5,10,15,20], [1,6,11,16,21], [2,7,12,17,22], [3,8,13,18,23], [4,9,14,19,24],
                [0,6,12,18,24], [4,8,12,16,20]
            ];
            if(wins.some(combo => combo.every(i => markedIndices.includes(i)))) {
                playSound('win');
                fireConfetti();
                document.getElementById('overlay').classList.add('visible');
            }
        }

        function fireConfetti() {
            const canvas = document.getElementById('confetti-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            const particles = [];
            for(let i=0; i<80; i++) {
                particles.push({
                    x: window.innerWidth / 2, y: window.innerHeight / 2,
                    vx: (Math.random() - 0.5) * 25, vy: (Math.random() - 0.5) * 25,
                    color: `hsl(${Math.random()*360}, 100%, 50%)`, life: 120
                });
            }
            function animate() {
                ctx.clearRect(0,0,canvas.width, canvas.height);
                let active = false;
                particles.forEach(p => {
                    if(p.life > 0) {
                        p.x += p.vx; p.y += p.vy; p.vy += 0.5; p.life -= 2;
                        ctx.fillStyle = p.color; ctx.fillRect(p.x, p.y, 6, 6);
                        active = true;
                    }
                });
                if(active) requestAnimationFrame(animate);
            }
            animate();
        }

        // Init
        initTheme();
    </script>
</body>
</html>
