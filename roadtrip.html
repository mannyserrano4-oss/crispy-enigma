<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>Road Trip Hub</title>
    <meta name="apple-mobile-web-app-title" content="Road Trip Hub">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="apple-touch-icon" href="icon.png">
    <link rel="icon" type="image/png" href="icon.png">

    <style>
        :root {
            --bg-dark: #121212;
            --surface: #1e1e1e;
            --primary: #bb86fc;
            --secondary: #03dac6;
            --error: #cf6679;
            --on-bg: #ffffff;
            --bingo-mark: #4cd137;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-dark);
            color: var(--on-bg);
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            user-select: none;
            -webkit-user-select: none;
        }

        /* --- NAVIGATION --- */
        .screen {
            display: none;
            flex-direction: column;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0; left: 0;
            background: var(--bg-dark);
            overflow-y: auto;
        }
        .screen.active { display: flex; }

        .nav-header {
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255,255,255,0.05);
            border-bottom: 1px solid #333;
            z-index: 10;
        }

        .home-btn {
            background: none; border: none; font-size: 1.5rem; cursor: pointer; padding: 5px;
        }

        .screen-title { font-size: 1.2rem; font-weight: bold; text-transform: uppercase; letter-spacing: 2px; color: var(--secondary); margin: 0; }

        /* --- HOME SCREEN --- */
        #screen-home {
            justify-content: center;
            align-items: center;
            padding: 20px;
            gap: 20px;
        }

        .menu-card {
            background: var(--surface);
            width: 100%;
            max-width: 350px;
            padding: 25px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            gap: 20px;
            cursor: pointer;
            border: 1px solid #333;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            transition: transform 0.1s;
        }
        .menu-card:active { transform: scale(0.98); background: #2a2a2a; }

        .menu-icon { font-size: 2.5rem; }
        .menu-info h2 { margin: 0; font-size: 1.4rem; }
        .menu-info p { margin: 5px 0 0 0; color: #888; font-size: 0.9rem; }

        /* --- GAME 1: DEEP DIVE --- */
        #screen-dive { align-items: center; justify-content: space-between; padding-bottom: 40px; }

        .category-scroll {
            display: flex;
            gap: 10px;
            padding: 15px;
            overflow-x: auto;
            width: 100%;
            box-sizing: border-box;
        }

        .cat-chip {
            background: #333;
            color: #aaa;
            padding: 8px 16px;
            border-radius: 20px;
            white-space: nowrap;
            font-size: 0.9rem;
            border: 1px solid #444;
            cursor: pointer;
        }
        .cat-chip.active { background: var(--primary); color: black; border-color: var(--primary); font-weight: bold; }

        .card-container {
            flex-grow: 1;
            width: 90%;
            max-width: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            perspective: 1000px;
        }

        .question-card {
            background: var(--surface);
            width: 100%;
            height: 300px;
            border-radius: 20px;
            padding: 30px;
            box-sizing: border-box;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 1.5rem; /* Slightly smaller for longer questions */
            font-weight: bold;
            line-height: 1.4;
            border: 1px solid #444;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            transition: transform 0.3s;
        }

        .controls-dive {
            display: flex;
            gap: 20px;
            width: 90%;
            max-width: 400px;
        }

        .action-btn {
            flex: 1;
            padding: 20px;
            border-radius: 12px;
            border: none;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
        }
        .btn-pass { background: #333; color: var(--error); border: 1px solid var(--error); }
        .btn-next { background: var(--secondary); color: black; }

        /* --- GAME 2: THE PITCH --- */
        #screen-pitch { padding: 20px; align-items: center; }

        .pitch-box {
            background: var(--surface);
            width: 100%;
            max-width: 400px;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid #333;
        }

        .pitch-label { color: #888; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; }
        .pitch-content { font-size: 1.2rem; font-weight: bold; color: var(--on-bg); min-height: 1.6em;}

        .timer-display {
            font-size: 4rem;
            font-weight: 900;
            color: var(--primary);
            margin: 20px 0;
            font-variant-numeric: tabular-nums;
        }

        .pitch-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            max-width: 400px;
        }

        /* --- GAME 3: BINGO (Integrated) --- */
        #bingo-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: 4px;
            padding: 10px;
            max-width: 600px;
            width: 100%;
            margin: 0 auto;
            aspect-ratio: 1/1; 
        }

        .bingo-tile {
            background: #2d3436;
            border: 1px solid #444;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 0.65rem;
            line-height: 1.1;
            font-weight: 600;
            padding: 2px;
            cursor: pointer;
            overflow: hidden;
        }

        .bingo-tile.marked { background: var(--bingo-mark); color: black; border-color: var(--bingo-mark); font-weight: bold; }
        .bingo-tile.free { background: var(--primary); color: black; }

        /* --- OVERLAYS --- */
        #overlay {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: rgba(30,30,30, 0.95);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            border: 2px solid var(--secondary);
            z-index: 100;
            transition: transform 0.2s;
            width: 80%;
        }
        #overlay.visible { transform: translate(-50%, -50%) scale(1); }
        .overlay-text { font-size: 2.5rem; color: var(--secondary); margin: 0 0 10px 0; }

        #confetti-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 90; }

    </style>
</head>
<body>

    <canvas id="confetti-canvas"></canvas>

    <div id="screen-home" class="screen active">
        <h1 style="text-align: center; margin-bottom: 10px;">ROAD TRIP HUB</h1>
        
        <div class="menu-card" onclick="navTo('dive')">
            <div class="menu-icon">üí¨</div>
            <div class="menu-info">
                <h2>Deep Dive</h2>
                <p>160+ Conversation starters</p>
            </div>
        </div>

        <div class="menu-card" onclick="navTo('pitch')">
            <div class="menu-icon">üé¨</div>
            <div class="menu-info">
                <h2>The Pitch</h2>
                <p>180k+ Movie ideas</p>
            </div>
        </div>

        <div class="menu-card" onclick="navTo('bingo')">
            <div class="menu-icon">üõ£Ô∏è</div>
            <div class="menu-info">
                <h2>Highway Bingo</h2>
                <p>150+ Road trip items</p>
            </div>
        </div>
    </div>

    <div id="screen-dive" class="screen">
        <div class="nav-header">
            <button class="home-btn" onclick="navTo('home')">üè†</button>
            <div class="screen-title">Deep Dive</div>
            <div style="width: 24px;"></div>
        </div>

        <div class="category-scroll">
            <div class="cat-chip active" onclick="setCategory('all', this)">All</div>
            <div class="cat-chip" onclick="setCategory('fun', this)">Fun</div>
            <div class="cat-chip" onclick="setCategory('deep', this)">Deep</div>
            <div class="cat-chip" onclick="setCategory('spicy', this)">Spicy</div>
            <div class="cat-chip" onclick="setCategory('retro', this)">Nostalgia</div>
        </div>

        <div class="card-container">
            <div id="question-text" class="question-card">
                Tap Next to Start
            </div>
        </div>

        <div class="controls-dive">
            <button class="action-btn btn-pass" onclick="passQuestion()">üêî Pass</button>
            <button class="action-btn btn-next" onclick="nextQuestion()">Next ‚ûî</button>
        </div>
    </div>

    <div id="screen-pitch" class="screen">
        <div class="nav-header">
            <button class="home-btn" onclick="navTo('home')">üè†</button>
            <div class="screen-title">The Pitch</div>
            <div style="width: 24px;"></div>
        </div>

        <div class="pitch-box" style="margin-top: 20px;">
            <div class="pitch-label">Genre</div>
            <div class="pitch-content" id="pitch-genre">---</div>
        </div>
        <div class="pitch-box">
            <div class="pitch-label">Protagonist</div>
            <div class="pitch-content" id="pitch-hero">---</div>
        </div>
        <div class="pitch-box">
            <div class="pitch-label">The Twist</div>
            <div class="pitch-content" id="pitch-twist">---</div>
        </div>

        <div class="timer-display" id="pitch-timer">60</div>

        <div class="pitch-controls">
            <button class="action-btn btn-next" onclick="generatePitch()">Generate New Movie</button>
            <button class="action-btn" style="background: #333; color: white; border: 1px solid #555;" onclick="startPitchTimer()">Start Timer</button>
        </div>
    </div>

    <div id="screen-bingo" class="screen">
        <div class="nav-header">
            <button class="home-btn" onclick="navTo('home')">üè†</button>
            <div class="screen-title">Bingo</div>
            <button class="home-btn" style="font-size: 1rem; background: #333; border-radius: 8px;" onclick="newBingoGame()">RESET</button>
        </div>

        <div id="bingo-grid"></div>
    </div>

    <div id="overlay" onclick="this.classList.remove('visible')">
        <div class="overlay-text">BINGO!</div>
        <div>Tap to continue</div>
    </div>

    <script>
        // --- DATA SETS (MASSIVE EXPANSION) ---
        
        // 1. DEEP DIVE QUESTIONS (40 per category)
        const questionsDB = {
            fun: [
                "What is the weirdest food combination you secretly enjoy?", "If you could instantly learn any skill, what would it be?", 
                "Which movie character is basically you?", "If you had to start a cult, what would it be about?",
                "What‚Äôs the most useless talent you have?", "If animals could talk, which would be the rudest?",
                "What would your wrestling name and finishing move be?", "What‚Äôs the worst haircut you‚Äôve ever had?",
                "If you were a ghost, who would you haunt?", "What is the dumbest way you‚Äôve injured yourself?",
                "If you could have an unlimited supply of one thing, what would it be?", "What song would be your entrance theme?",
                "If you could legally steal one thing, what would it be?", "Who would play you in a movie of your life?",
                "What‚Äôs a trend you hope never comes back?", "What‚Äôs the strangest gift you‚Äôve ever received?",
                "If you could speak to one type of animal, which would it be?", "What‚Äôs your go-to karaoke song?",
                "If you had to live in a video game, which one?", "What‚Äôs the best prank you‚Äôve ever pulled?",
                "If you could teleport anywhere right now, where to?", "What‚Äôs the funniest wifi name you‚Äôve seen?",
                "What‚Äôs your zombie apocalypse plan?", "If you won the lottery, what‚Äôs the first dumb thing you‚Äôd buy?",
                "What is the most boring sport to watch?", "If you were a flavor of ice cream, what would you be?",
                "What‚Äôs a movie everyone loves but you hate?", "What‚Äôs the weirdest thing in your fridge right now?",
                "If you could swap lives with anyone for a day, who?", "What‚Äôs your spirit animal?",
                "What‚Äôs the most embarrassing thing you own?", "If you could rename yourself, what name would you pick?",
                "What‚Äôs the worst job you can imagine?", "If you could only eat one food forever, what would it be?",
                "What‚Äôs a superstition you actually believe?", "Who is the funniest person you know?",
                "What‚Äôs the best compliment you‚Äôve ever received?", "If you were famous, what would you be famous for?",
                "What‚Äôs your favorite dad joke?", "If you could un-invent one thing, what would it be?"
            ],
            deep: [
                "What is your biggest fear that you rarely admit?", "What‚Äôs one thing you‚Äôd change about your past?",
                "What does a perfect day look like to you?", "Who has influenced you the most in life?",
                "What is the hardest lesson you‚Äôve had to learn?", "When did you last cry and why?",
                "What is something you are struggling with right now?", "What do you want to be remembered for?",
                "What is your definition of success?", "If you knew you couldn‚Äôt fail, what would you do?",
                "What is a dream you‚Äôve let go of?", "Who do you wish you were closer to?",
                "What is the best piece of advice you‚Äôve ever received?", "What are you most grateful for?",
                "If you died tomorrow, what would you regret not doing?", "What is one thing you love about yourself?",
                "What is a habit you wish you could break?", "What makes you feel most alive?",
                "What do you think happens after we die?", "If you could ask God one question, what would it be?",
                "What is the biggest risk you‚Äôve ever taken?", "When have you felt the most proud?",
                "What is a memory you hope you never forget?", "What is something you‚Äôve forgiven yourself for?",
                "What do you value most in a friendship?", "What is something you wish you knew 10 years ago?",
                "What is the biggest misconception people have about you?", "What is your love language?",
                "If you could change one thing about the world, what would it be?", "What keeps you up at night?",
                "What is a relationship breaker for you?", "Who do you look up to?",
                "What makes a house feel like a home?", "What is your biggest insecurity?",
                "If you could write a letter to your younger self, what would it say?", "What is the kindest thing someone has done for you?",
                "What are you most passionate about?", "How do you handle stress?",
                "What is a book or movie that changed your life?", "What does happiness mean to you?"
            ],
            spicy: [
                "What's a secret you've kept from your parents?", "Worst date you've ever been on?",
                "What is an unpopular opinion you hold?", "Have you ever ghosted someone and why?",
                "What is the pettiest thing you‚Äôve ever done?", "Have you ever cheated on anything?",
                "What‚Äôs a lie you‚Äôve told that got out of hand?", "Who in this car would survive the longest in prison?",
                "What‚Äôs the most illegal thing you‚Äôve done?", "Have you ever snooped through a partner's phone?",
                "What is your biggest turn-off?", "What‚Äôs the worst text you‚Äôve sent to the wrong person?",
                "Have you ever had a crush on a friend's partner?", "What‚Äôs a rumor you started?",
                "Who was your worst kiss?", "What‚Äôs the most expensive thing you‚Äôve broken?",
                "Have you ever stolen anything?", "What‚Äôs the meanest thing you‚Äôve ever said?",
                "Who is your celebrity hall pass?", "What‚Äôs a habit of yours that annoys others?",
                "Have you ever been fired?", "What is your most toxic trait?",
                "Have you ever peed in a pool?", "Who is the worst driver in this car?",
                "What‚Äôs something you judge people for?", "Have you ever been in a fist fight?",
                "What‚Äôs the most embarrassing thing you‚Äôve done drunk?", "Have you ever lied to get out of a date?",
                "What is your guilty pleasure?", "Have you ever stalked an ex on social media?",
                "What‚Äôs the worst thing you‚Äôve eaten out of politeness?", "Have you ever re-gifted a present?",
                "Who in this car is the most likely to get arrested?", "What is the worst advice you‚Äôve given?",
                "Have you ever faked being sick to skip work?", "What‚Äôs the cringiest thing you posted online?",
                "Have you ever broken a bone doing something stupid?", "What‚Äôs a secret you know about someone else?",
                "Have you ever been caught in a lie?", "What is the wildest place you‚Äôve hooked up?"
            ],
            retro: [
                "First album you ever bought?", "Favorite childhood cartoon?",
                "What was your first car?", "Best toy from the 90s/00s?",
                "What was your favorite school lunch?", "First movie you saw in theaters?",
                "What was your AIM/MSN screen name?", "What poster was on your bedroom wall?",
                "First concert you attended?", "Favorite candy growing up?",
                "What was your favorite playground game?", "Did you have a collection? (Pogs, Pokemon, Beanie Babies)",
                "What was your first cell phone?", "Favorite video game as a kid?",
                "What fashion trend do you regret following?", "Who was your childhood celebrity crush?",
                "What TV show intro can you still sing?", "What was your favorite board game?",
                "Did you have a tamagotchi?", "What was the first website you visited regularly?",
                "Favorite book series as a kid?", "What was your favorite Halloween costume?",
                "Did you burn CDs? What was on your mix?", "What was your curfew?",
                "Favorite cereal?", "Did you go to Blockbuster? What was your section?",
                "What slang word did you use too much?", "What was your favorite field trip?",
                "Did you have a myspace? What was your song?", "What was your favorite arcade game?",
                "Who was your favorite teacher?", "What commercial jingle is stuck in your head?",
                "Did you own a Walkman/Discman?", "What was your favorite summer activity?",
                "What scared you as a kid?", "Did you pass notes in class?",
                "What was your favorite ice cream truck treat?", "Did you have a treehouse or fort?",
                "What was the first R-rated movie you saw?", "Favorite childhood memory?"
            ]
        };

        // Deep Dive State - using "Decks" to prevent repeats
        let decks = {
            fun: [...questionsDB.fun],
            deep: [...questionsDB.deep],
            spicy: [...questionsDB.spicy],
            retro: [...questionsDB.retro]
        };
        let currentCat = 'all';

        // 2. THE PITCH DATASETS (Massive expansion)
        const pitchData = {
            genres: [
                "Horror", "RomCom", "Sci-Fi", "Western", "Musical", "Action", "Documentary", 
                "Fantasy", "Cyberpunk", "Noir", "Teen Drama", "Holiday Movie", "Sports Drama",
                "Buddy Cop", "Heist", "Zombie Apocalypse", "Courtroom Drama", "Silent Film",
                "Anime", "Soap Opera", "Mockumentary", "Slasher", "Time Travel", "War Epic",
                "Spy Thriller", "Cooking Show", "Reality TV", "Superhero", "Disaster Movie",
                "Period Piece", "Space Opera", "Vampire Romance", "Kung Fu", "Legal Thriller",
                "Political Satire", "Found Footage", "Biopic", "Coming of Age", "Psychological Thriller",
                "Monster Movie", "Musical Biopic", "Christmas Horror", "Stoner Comedy", "Road Trip",
                "Murder Mystery", "Erotic Thriller", "Stop Motion", "Bollywood", "Surrealist Art Film"
            ],
            heroes: [
                "A washed-up clown", "A sentient toaster", "Elon Musk's clone", "A distracted Uber driver", 
                "A tired kindergarten teacher", "A time-traveling dog", "A vegan vampire", "A retired hitman",
                "A ghost who is afraid of people", "A corrupt politician", "A delusional influencer",
                "A barista with a dark secret", "A cat who thinks it's God", "A clumsy ninja",
                "A robot who wants to be a chef", "A dissatisfied alien tourist", "A pirate with motion sickness",
                "A nervous bomb disposal expert", "A disgruntled Santa Claus", "A mime who can't stop talking",
                "A teenage witch", "A professional cuddler", "A cynical wedding planner",
                "A disgraced astronaut", "A lottery winner who lost the ticket", "A conspiracy theorist",
                "A grumpy librarian", "A reckless taxi driver", "A struggling soundcloud rapper",
                "A man who is allergic to everything", "A woman who can hear plants", "A detective who is always wrong",
                "A super soldier with amnesia", "A divorced dad", "A Karen", "A yoga instructor",
                "A disgruntled IT guy", "A bus driver", "A reality TV star", "A failed magician",
                "A sentient AI", "A talking sword", "A shapeshifter", "A weary god",
                "A pizza delivery guy", "A bored grim reaper", "A park ranger", "A cruise ship captain",
                "A wedding DJ", "A blind sniper", "A motivational speaker", "A used car salesman"
            ],
            twists: [
                "It was all a simulation", "The dog is the mastermind", "They are actually ghosts", 
                "The villain is their future self", "The world ends in 24 hours", "They fall in love",
                "It was a musical all along", "Everyone is a robot", "It takes place in a microscopic world",
                "The narrator is lying", "They are trapped in a time loop", "Gravity stops working",
                "The hero dies in the first 5 minutes", "Aliens invade halfway through",
                "It was a dream within a dream", "The main character doesn't exist",
                "The audience is the killer", "Animals start talking", "The sun explodes",
                "They switch bodies", "It's a prequel to Shrek", "They realize they are in a movie",
                "The villain is the hero's dad", "Magic is real", "Zombies show up",
                "The car is alive", "They win the lottery but lose the ticket", "It's a cooking competition",
                "They are all in purgatory", "The weapon is love", "The bomb is made of chocolate",
                "Everyone is blind", "The ocean dries up", "The internet becomes sentient",
                "Plants take over", "Time flows backwards", "They are shrunken down",
                "It's actually a commercial", "The sidekick is the chosen one", "They can't stop dancing",
                "Silence kills", "Looking at the sky makes you crazy", "Water turns to wine",
                "Dinosaurs return", "The moon falls", "Shadows come to life",
                "The protagonist is the villain", "They are stuck in an elevator", "Someone is an imposter",
                "The floor is lava", "They have to sing to survive", "Only the dog survives"
            ]
        };

        // 3. BINGO DATA (Keep previous logic)
        const bingoItems = [
            "Police Car", "Ambulance", "Fire Truck", "Motorcycle", "Yellow Car", "Pink Car", "Classic Car", "Convertible", "Tesla", "Jeep w/ Ducks",
            "VW Beetle", "Smart Car", "Hummer", "Stick Family", "School Bus", "RV / Motorhome", "Boat on Trailer", "FedEx Truck", "UPS Truck", "Amazon Van",
            "Walmart Truck", "Gas Tanker", "Car Carrier", "Cement Mixer", "Garbage Truck", "U-Haul", "Dog Head out Window", "Feet on Dash", "Driver Singing",
            "Someone Sleeping", "Waffle House", "Cracker Barrel", "Buc-ee's", "McDonald's", "Starbucks", "Dollar General", "Billboard: Lawyer", "Billboard: Jesus",
            "Billboard: Adult", "Speed Limit 70", "State Line", "Rest Area", "Weigh Station", "Exit 69", "Exit 420", "Construction", "Water Tower", "Cell Tower Tree",
            "Wind Turbine", "Solar Farm", "Cows", "Horses", "Roadkill", "Train", "Bridge", "Tunnel", "Airplane", "Out of State Plate", "Vanity Plate", "Student Driver",
            "Baby on Board", "Broken Taillight", "Missing Hubcap", "Spare Tire", "Very Muddy Truck", "Roof Rack", "Bicycles", "Mattress on Roof"
        ];

        // --- AUDIO ENGINE ---
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();

        document.addEventListener('touchstart', unlockAudio, { once: true });
        document.addEventListener('click', unlockAudio, { once: true });

        function unlockAudio() { if (audioCtx.state === 'suspended') audioCtx.resume(); }

        function playSound(type) {
            unlockAudio();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            const now = audioCtx.currentTime;

            if (type === 'swipe') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(300, now);
                osc.frequency.exponentialRampToValueAtTime(100, now + 0.1);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
                osc.start(now); osc.stop(now + 0.1);
            } else if (type === 'chicken') {
                const cluck = (t) => {
                    const o = audioCtx.createOscillator();
                    const g = audioCtx.createGain();
                    o.connect(g); g.connect(audioCtx.destination);
                    o.type = 'square';
                    o.frequency.setValueAtTime(400, t);
                    o.frequency.exponentialRampToValueAtTime(300, t+0.1);
                    g.gain.setValueAtTime(0.2, t);
                    g.gain.exponentialRampToValueAtTime(0.001, t+0.1);
                    o.start(t); o.stop(t+0.1);
                };
                cluck(now); cluck(now+0.15); cluck(now+0.3);
            } else if (type === 'alarm') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(800, now);
                osc.frequency.linearRampToValueAtTime(600, now+0.3);
                gain.gain.setValueAtTime(0.2, now);
                gain.gain.linearRampToValueAtTime(0, now+0.3);
                osc.start(now); osc.stop(now+0.3);
            } else if (type === 'win') {
                [523, 659, 783, 1046].forEach((f, i) => {
                    const o = audioCtx.createOscillator();
                    const g = audioCtx.createGain();
                    o.connect(g); g.connect(audioCtx.destination);
                    o.type = 'triangle';
                    o.frequency.value = f;
                    g.gain.setValueAtTime(0.1, now + i*0.1);
                    g.gain.exponentialRampToValueAtTime(0.001, now + i*0.1 + 0.5);
                    o.start(now + i*0.1); o.stop(now + i*0.1 + 0.5);
                });
            }
        }

        // --- NAVIGATION ---
        function navTo(screenId) {
            playSound('swipe');
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(`screen-${screenId}`).classList.add('active');
            
            if(screenId === 'bingo' && document.getElementById('bingo-grid').children.length === 0) newBingoGame();
            if(screenId === 'pitch' && document.getElementById('pitch-hero').innerText === '---') generatePitch();
        }

        // --- GAME 1: DEEP DIVE (Logic Updated for No Repeats) ---
        function setCategory(cat, el) {
            currentCat = cat;
            document.querySelectorAll('.cat-chip').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            playSound('swipe');
        }

        function nextQuestion() {
            playSound('swipe');
            let poolName = currentCat;
            let pool = [];

            // If "all", pick a random category first, then pick from that deck
            if (currentCat === 'all') {
                const cats = ['fun', 'deep', 'spicy', 'retro'];
                poolName = cats[Math.floor(Math.random() * cats.length)];
            }
            
            // Check if deck is empty, if so, refill it
            if (decks[poolName].length === 0) {
                decks[poolName] = [...questionsDB[poolName]]; // Refill
            }

            // Pick random index
            const index = Math.floor(Math.random() * decks[poolName].length);
            const q = decks[poolName][index];
            
            // Remove it from the deck so it doesn't repeat
            decks[poolName].splice(index, 1);
            
            const card = document.getElementById('question-text');
            card.style.transform = "scale(0.9)";
            setTimeout(() => {
                card.innerText = q;
                card.style.transform = "scale(1)";
            }, 100);
        }

        function passQuestion() {
            playSound('chicken');
            const card = document.getElementById('question-text');
            card.innerText = "üêî CHICKEN! üêî";
        }

        // --- GAME 2: THE PITCH ---
        let pitchTimer = null;

        function generatePitch() {
            playSound('swipe');
            clearInterval(pitchTimer);
            document.getElementById('pitch-timer').innerText = "60";
            document.getElementById('pitch-timer').style.color = "#bb86fc";

            document.getElementById('pitch-genre').innerText = pitchData.genres[Math.floor(Math.random() * pitchData.genres.length)];
            document.getElementById('pitch-hero').innerText = pitchData.heroes[Math.floor(Math.random() * pitchData.heroes.length)];
            document.getElementById('pitch-twist').innerText = pitchData.twists[Math.floor(Math.random() * pitchData.twists.length)];
        }

        function startPitchTimer() {
            playSound('swipe');
            clearInterval(pitchTimer);
            let time = 60;
            const display = document.getElementById('pitch-timer');
            
            pitchTimer = setInterval(() => {
                time--;
                display.innerText = time;
                if(time <= 10) display.style.color = "#cf6679"; 
                if(time <= 0) {
                    clearInterval(pitchTimer);
                    playSound('alarm');
                    display.innerText = "TIME!";
                }
            }, 1000);
        }

        // --- GAME 3: BINGO (Same Logic) ---
        let markedIndices = [];

        function newBingoGame() {
            playSound('swipe');
            let deck = [...bingoItems];
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            const selected = deck.slice(0, 24);
            selected.splice(12, 0, "FREE SPACE");

            markedIndices = [12];
            renderBingo(selected);
        }

        function renderBingo(items) {
            const grid = document.getElementById('bingo-grid');
            grid.innerHTML = '';
            items.forEach((item, index) => {
                const tile = document.createElement('div');
                tile.className = 'bingo-tile';
                tile.innerText = item;
                if(index === 12) tile.classList.add('free', 'marked');
                tile.onclick = () => {
                    if(index === 12) return;
                    if(markedIndices.includes(index)) {
                        markedIndices = markedIndices.filter(i => i !== index);
                        tile.classList.remove('marked');
                    } else {
                        markedIndices.push(index);
                        tile.classList.add('marked');
                        playSound('swipe');
                        checkBingo();
                    }
                };
                grid.appendChild(tile);
            });
        }

        function checkBingo() {
            const wins = [
                [0,1,2,3,4], [5,6,7,8,9], [10,11,12,13,14], [15,16,17,18,19], [20,21,22,23,24],
                [0,5,10,15,20], [1,6,11,16,21], [2,7,12,17,22], [3,8,13,18,23], [4,9,14,19,24],
                [0,6,12,18,24], [4,8,12,16,20]
            ];
            if(wins.some(combo => combo.every(i => markedIndices.includes(i)))) {
                playSound('win');
                fireConfetti();
                document.getElementById('overlay').classList.add('visible');
            }
        }

        function fireConfetti() {
            const canvas = document.getElementById('confetti-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            const particles = [];
            for(let i=0; i<80; i++) {
                particles.push({
                    x: window.innerWidth / 2, y: window.innerHeight / 2,
                    vx: (Math.random() - 0.5) * 25, vy: (Math.random() - 0.5) * 25,
                    color: `hsl(${Math.random()*360}, 100%, 50%)`, life: 120
                });
            }
            function animate() {
                ctx.clearRect(0,0,canvas.width, canvas.height);
                let active = false;
                particles.forEach(p => {
                    if(p.life > 0) {
                        p.x += p.vx; p.y += p.vy; p.vy += 0.5; p.life -= 2;
                        ctx.fillStyle = p.color; ctx.fillRect(p.x, p.y, 6, 6);
                        active = true;
                    }
                });
                if(active) requestAnimationFrame(animate);
            }
            animate();
        }
    </script>
</body>
</html>
