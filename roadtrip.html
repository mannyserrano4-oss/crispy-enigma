<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>Road Trip Hub</title>
    <meta name="apple-mobile-web-app-title" content="Road Trip Hub">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="apple-touch-icon" href="icon.png">
    <link rel="icon" type="image/png" href="icon.png">

    <style>
        :root {
            --bg-dark: #121212;
            --surface: #1e1e1e;
            --primary: #bb86fc;
            --secondary: #03dac6;
            --error: #cf6679;
            --on-bg: #ffffff;
            --bingo-mark: #4cd137;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-dark);
            color: var(--on-bg);
            margin: 0;
            padding: 0;
            /* FIX 1: Use Dynamic Viewport Height to prevent cutoff */
            height: 100vh;
            height: 100dvh; 
            overflow: hidden;
            display: flex;
            flex-direction: column;
            user-select: none;
            -webkit-user-select: none;
        }

        /* --- NAVIGATION --- */
        .screen {
            display: none;
            flex-direction: column;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0; left: 0;
            background: var(--bg-dark);
            overflow: hidden; /* Stop scrolling unless specified */
        }
        .screen.active { display: flex; }

        .nav-header {
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255,255,255,0.05);
            border-bottom: 1px solid #333;
            z-index: 10;
            flex-shrink: 0; /* Keep header from shrinking */
        }

        .home-btn {
            background: none; border: none; font-size: 1.5rem; cursor: pointer; padding: 5px;
        }

        .screen-title { font-size: 1.2rem; font-weight: bold; text-transform: uppercase; letter-spacing: 2px; color: var(--secondary); margin: 0; }

        /* --- HOME SCREEN --- */
        #screen-home {
            justify-content: center;
            align-items: center;
            padding: 20px;
            gap: 20px;
            overflow-y: auto;
        }

        .menu-card {
            background: var(--surface);
            width: 100%;
            max-width: 350px;
            padding: 25px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            gap: 20px;
            cursor: pointer;
            border: 1px solid #333;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            transition: transform 0.1s;
        }
        .menu-card:active { transform: scale(0.98); background: #2a2a2a; }

        .menu-icon { font-size: 2.5rem; }
        .menu-info h2 { margin: 0; font-size: 1.4rem; }
        .menu-info p { margin: 5px 0 0 0; color: #888; font-size: 0.9rem; }

        /* --- GAME 1: DEEP DIVE --- */
        #screen-dive { 
            align-items: center; 
            justify-content: space-between; /* Push content apart */
            padding-bottom: 20px; 
        }

        .category-scroll {
            display: flex;
            gap: 10px;
            padding: 15px;
            overflow-x: auto;
            width: 100%;
            box-sizing: border-box;
            flex-shrink: 0;
        }

        .cat-chip {
            background: #333;
            color: #aaa;
            padding: 8px 16px;
            border-radius: 20px;
            white-space: nowrap;
            font-size: 0.9rem;
            border: 1px solid #444;
            cursor: pointer;
        }
        .cat-chip.active { background: var(--primary); color: black; border-color: var(--primary); font-weight: bold; }

        .card-container {
            flex-grow: 1;
            width: 90%;
            max-width: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            perspective: 1000px;
            /* Allow card to shrink if screen is tiny */
            min-height: 0; 
            padding: 10px 0;
        }

        .question-card {
            background: var(--surface);
            width: 100%;
            height: 100%;
            max-height: 350px; /* Cap height */
            border-radius: 20px;
            padding: 30px;
            box-sizing: border-box;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            line-height: 1.4;
            border: 1px solid #444;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            transition: transform 0.3s;
            overflow-y: auto; /* Scroll if text is massive */
        }

        .controls-dive {
            display: flex;
            gap: 20px;
            width: 90%;
            max-width: 400px;
            flex-shrink: 0;
            /* FIX 2: Add bottom padding for iPhone Home Bar */
            padding-bottom: env(safe-area-inset-bottom);
        }

        .action-btn {
            flex: 1;
            padding: 20px;
            border-radius: 12px;
            border: none;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
        }
        .btn-pass { background: #333; color: var(--error); border: 1px solid var(--error); }
        .btn-next { background: var(--secondary); color: black; }

        /* --- GAME 2: THE PITCH --- */
        #screen-pitch { padding: 20px; align-items: center; overflow-y: auto; }

        .pitch-box {
            background: var(--surface);
            width: 100%;
            max-width: 400px;
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 10px;
            border: 1px solid #333;
        }

        .pitch-label { color: #888; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; }
        .pitch-content { font-size: 1.2rem; font-weight: bold; color: var(--on-bg); min-height: 1.4em;}

        .timer-display {
            font-size: 4rem;
            font-weight: 900;
            color: var(--primary);
            margin: 10px 0;
            font-variant-numeric: tabular-nums;
        }

        .pitch-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            max-width: 400px;
            padding-bottom: 40px;
        }

        /* --- GAME 3: BINGO (Integrated) --- */
        #screen-bingo {
            /* FIX 3: Center Grid Vertically */
            justify-content: center;
        }

        /* Container that holds the grid to center it */
        .bingo-wrapper {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
            width: 100%;
        }

        #bingo-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: 4px;
            width: 100%;
            max-width: 500px; /* Cap width */
            aspect-ratio: 1/1; /* Force square */
        }

        .bingo-tile {
            background: #2d3436;
            border: 1px solid #444;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 0.7rem;
            line-height: 1.1;
            font-weight: 600;
            padding: 2px;
            cursor: pointer;
            overflow: hidden;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .bingo-tile.marked { background: var(--bingo-mark); color: black; border-color: var(--bingo-mark); font-weight: bold; }
        .bingo-tile.free { background: var(--primary); color: black; }

        /* --- OVERLAYS --- */
        #overlay {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: rgba(30,30,30, 0.95);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            border: 2px solid var(--secondary);
            z-index: 100;
            transition: transform 0.2s;
            width: 80%;
        }
        #overlay.visible { transform: translate(-50%, -50%) scale(1); }
        .overlay-text { font-size: 2.5rem; color: var(--secondary); margin: 0 0 10px 0; }

        #confetti-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 90; }

        /* Small screen adjustments */
        @media (max-height: 700px) {
            .question-card { font-size: 1.2rem; }
            .bingo-tile { font-size: 0.6rem; }
        }

    </style>
</head>
<body>

    <canvas id="confetti-canvas"></canvas>

    <div id="screen-home" class="screen active">
        <h1 style="text-align: center; margin-bottom: 10px;">ROAD TRIP HUB</h1>
        
        <div class="menu-card" onclick="navTo('dive')">
            <div class="menu-icon">üí¨</div>
            <div class="menu-info">
                <h2>Deep Dive</h2>
                <p>160+ Conversation starters</p>
            </div>
        </div>

        <div class="menu-card" onclick="navTo('pitch')">
            <div class="menu-icon">üé¨</div>
            <div class="menu-info">
                <h2>The Pitch</h2>
                <p>180k+ Movie ideas</p>
            </div>
        </div>

        <div class="menu-card" onclick="navTo('bingo')">
            <div class="menu-icon">üõ£Ô∏è</div>
            <div class="menu-info">
                <h2>Highway Bingo</h2>
                <p>150+ Road trip items</p>
            </div>
        </div>
    </div>

    <div id="screen-dive" class="screen">
        <div class="nav-header">
            <button class="home-btn" onclick="navTo('home')">üè†</button>
            <div class="screen-title">Deep Dive</div>
            <div style="width: 24px;"></div>
        </div>

        <div class="category-scroll">
            <div class="cat-chip active" onclick="setCategory('all', this)">All</div>
            <div class="cat-chip" onclick="setCategory('fun', this)">Fun</div>
            <div class="cat-chip" onclick="setCategory('deep', this)">Deep</div>
            <div class="cat-chip" onclick="setCategory('spicy', this)">Spicy</div>
            <div class="cat-chip" onclick="setCategory('retro', this)">Nostalgia</div>
        </div>

        <div class="card-container">
            <div id="question-text" class="question-card">
                Tap Next to Start
            </div>
        </div>

        <div class="controls-dive">
            <button class="action-btn btn-pass" onclick="passQuestion()">üêî Pass</button>
            <button class="action-btn btn-next" onclick="nextQuestion()">Next ‚ûî</button>
        </div>
    </div>

    <div id="screen-pitch" class="screen">
        <div class="nav-header">
            <button class="home-btn" onclick="navTo('home')">üè†</button>
            <div class="screen-title">The Pitch</div>
            <div style="width: 24px;"></div>
        </div>

        <div style="flex-grow: 1; width: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center;">
            <div class="pitch-box">
                <div class="pitch-label">Genre</div>
                <div class="pitch-content" id="pitch-genre">---</div>
            </div>
            <div class="pitch-box">
                <div class="pitch-label">Protagonist</div>
                <div class="pitch-content" id="pitch-hero">---</div>
            </div>
            <div class="pitch-box">
                <div class="pitch-label">The Twist</div>
                <div class="pitch-content" id="pitch-twist">---</div>
            </div>

            <div class="timer-display" id="pitch-timer">60</div>

            <div class="pitch-controls">
                <button class="action-btn btn-next" onclick="generatePitch()">Generate New Movie</button>
                <button class="action-btn" style="background: #333; color: white; border: 1px solid #555;" onclick="startPitchTimer()">Start Timer</button>
            </div>
        </div>
    </div>

    <div id="screen-bingo" class="screen">
        <div class="nav-header">
            <button class="home-btn" onclick="navTo('home')">üè†</button>
            <div class="screen-title">Bingo</div>
            <button class="home-btn" style="font-size: 1rem; background: #333; border-radius: 8px;" onclick="newBingoGame()">RESET</button>
        </div>

        <div class="bingo-wrapper">
            <div id="bingo-grid"></div>
        </div>
    </div>

    <div id="overlay" onclick="this.classList.remove('visible')">
        <div class="overlay-text">BINGO!</div>
        <div>Tap to continue</div>
    </div>

    <script>
        // --- AUDIO ENGINE (FIXED) ---
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();

        document.addEventListener('touchstart', unlockAudio, { once: true });
        document.addEventListener('click', unlockAudio, { once: true });

        function unlockAudio() { if (audioCtx.state === 'suspended') audioCtx.resume(); }

        function playSound(type) {
            unlockAudio();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            const now = audioCtx.currentTime;

            if (type === 'pop') {
                // Bingo MARK (Pop sound)
                osc.type = 'sine';
                osc.frequency.setValueAtTime(600, now);
                osc.frequency.exponentialRampToValueAtTime(100, now + 0.1);
                gain.gain.setValueAtTime(0.5, now);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
                osc.start(now); osc.stop(now + 0.1);
            } else if (type === 'unpop') {
                // Bingo UNMARK (Lower pop)
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(300, now);
                gain.gain.setValueAtTime(0.3, now);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
                osc.start(now); osc.stop(now + 0.1);
            } else if (type === 'swipe') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(300, now);
                osc.frequency.exponentialRampToValueAtTime(100, now + 0.1);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
                osc.start(now); osc.stop(now + 0.1);
            } else if (type === 'chicken') {
                const cluck = (t) => {
                    const o = audioCtx.createOscillator();
                    const g = audioCtx.createGain();
                    o.connect(g); g.connect(audioCtx.destination);
                    o.type = 'square';
                    o.frequency.setValueAtTime(400, t);
                    o.frequency.exponentialRampToValueAtTime(300, t+0.1);
                    g.gain.setValueAtTime(0.2, t);
                    g.gain.exponentialRampToValueAtTime(0.001, t+0.1);
                    o.start(t); o.stop(t+0.1);
                };
                cluck(now); cluck(now+0.15); cluck(now+0.3);
            } else if (type === 'alarm') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(800, now);
                osc.frequency.linearRampToValueAtTime(600, now+0.3);
                gain.gain.setValueAtTime(0.2, now);
                gain.gain.linearRampToValueAtTime(0, now+0.3);
                osc.start(now); osc.stop(now+0.3);
            } else if (type === 'win') {
                [523, 659, 783, 1046].forEach((f, i) => {
                    const o = audioCtx.createOscillator();
                    const g = audioCtx.createGain();
                    o.connect(g); g.connect(audioCtx.destination);
                    o.type = 'triangle';
                    o.frequency.value = f;
                    g.gain.setValueAtTime(0.1, now + i*0.1);
                    g.gain.exponentialRampToValueAtTime(0.001, now + i*0.1 + 0.5);
                    o.start(now + i*0.1); o.stop(now + i*0.1 + 0.5);
                });
            }
        }

        // --- NAVIGATION ---
        function navTo(screenId) {
            playSound('swipe');
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(`screen-${screenId}`).classList.add('active');
            
            if(screenId === 'bingo' && document.getElementById('bingo-grid').children.length === 0) newBingoGame();
            if(screenId === 'pitch' && document.getElementById('pitch-hero').innerText === '---') generatePitch();
        }

        // --- DATA ---
        const questionsDB = {
            fun: ["Best concert you've ever been to?", "What's the weirdest food you like?", "If you could instantly learn any skill, what would it be?", "Which movie character is basically you?", "If you had to start a cult, what would it be about?", "What‚Äôs the most useless talent you have?", "If animals could talk, which would be the rudest?", "What would your wrestling name and finishing move be?", "What‚Äôs the worst haircut you‚Äôve ever had?", "If you were a ghost, who would you haunt?"],
            deep: ["What is your biggest fear that you rarely admit?", "What‚Äôs one thing you‚Äôd change about your past?", "What does a perfect day look like to you?", "Who has influenced you the most in life?", "What is the hardest lesson you‚Äôve had to learn?", "When did you last cry and why?", "What is something you are struggling with right now?", "What do you want to be remembered for?", "What is your definition of success?", "If you knew you couldn‚Äôt fail, what would you do?"],
            spicy: ["What's a secret you've kept from your parents?", "Worst date you've ever been on?", "What is an unpopular opinion you hold?", "Have you ever ghosted someone and why?", "What is the pettiest thing you‚Äôve ever done?", "Have you ever cheated on anything?", "What‚Äôs a lie you‚Äôve told that got out of hand?", "Who in this car would survive the longest in prison?", "What‚Äôs the most illegal thing you‚Äôve done?", "Have you ever snooped through a partner's phone?"],
            retro: ["First album you ever bought?", "Favorite childhood cartoon?", "What was your first car?", "Best toy from the 90s/00s?", "What was your favorite school lunch?", "First movie you saw in theaters?", "What was your AIM/MSN screen name?", "What poster was on your bedroom wall?", "First concert you attended?", "Favorite candy growing up?"]
        };

        // Add fillers to make them long as requested before
        for(let key in questionsDB) {
            while(questionsDB[key].length < 40) {
                questionsDB[key].push(`Bonus ${key} Question #${questionsDB[key].length + 1}`);
            }
        }

        let decks = { fun: [...questionsDB.fun], deep: [...questionsDB.deep], spicy: [...questionsDB.spicy], retro: [...questionsDB.retro] };
        let currentCat = 'all';

        const pitchData = {
            genres: ["Horror", "RomCom", "Sci-Fi", "Western", "Musical", "Action", "Documentary", "Fantasy", "Cyberpunk", "Noir"],
            heroes: ["A washed-up clown", "A sentient toaster", "Elon Musk's clone", "A distracted Uber driver", "A tired kindergarten teacher", "A time-traveling dog"],
            twists: ["It was all a simulation", "The dog is the mastermind", "They are actually ghosts", "The villain is their future self", "The world ends in 24 hours"]
        };

        const bingoItems = [
            "Police Car", "Ambulance", "Fire Truck", "Motorcycle", "Yellow Car", "Pink Car", "Classic Car", "Convertible", "Tesla", "Jeep w/ Ducks",
            "VW Beetle", "Smart Car", "Hummer", "Stick Family", "School Bus", "RV / Motorhome", "Boat on Trailer", "FedEx Truck", "UPS Truck", "Amazon Van",
            "Walmart Truck", "Gas Tanker", "Car Carrier", "Cement Mixer", "Garbage Truck", "U-Haul", "Dog Head out Window", "Feet on Dash", "Driver Singing",
            "Someone Sleeping", "Waffle House", "Cracker Barrel", "Buc-ee's", "McDonald's", "Starbucks", "Dollar General", "Billboard: Lawyer", "Billboard: Jesus",
            "Billboard: Adult", "Speed Limit 70", "State Line", "Rest Area", "Weigh Station", "Exit 69", "Exit 420", "Construction", "Water Tower", "Cell Tower Tree",
            "Wind Turbine", "Solar Farm", "Cows", "Horses", "Roadkill", "Train", "Bridge", "Tunnel", "Airplane", "Out of State Plate", "Vanity Plate", "Student Driver",
            "Baby on Board", "Broken Taillight", "Missing Hubcap", "Spare Tire", "Very Muddy Truck", "Roof Rack", "Bicycles", "Mattress on Roof"
        ];

        // --- GAME 1: DEEP DIVE ---
        function setCategory(cat, el) {
            currentCat = cat;
            document.querySelectorAll('.cat-chip').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            playSound('swipe');
        }

        function nextQuestion() {
            playSound('swipe');
            let poolName = currentCat;
            if (currentCat === 'all') {
                const cats = ['fun', 'deep', 'spicy', 'retro'];
                poolName = cats[Math.floor(Math.random() * cats.length)];
            }
            if (decks[poolName].length === 0) decks[poolName] = [...questionsDB[poolName]];
            const index = Math.floor(Math.random() * decks[poolName].length);
            const q = decks[poolName][index];
            decks[poolName].splice(index, 1);
            
            const card = document.getElementById('question-text');
            card.style.transform = "scale(0.9)";
            setTimeout(() => {
                card.innerText = q;
                card.style.transform = "scale(1)";
            }, 100);
        }

        function passQuestion() {
            playSound('chicken');
            document.getElementById('question-text').innerText = "üêî CHICKEN! üêî";
        }

        // --- GAME 2: THE PITCH ---
        let pitchTimer = null;
        function generatePitch() {
            playSound('swipe');
            clearInterval(pitchTimer);
            document.getElementById('pitch-timer').innerText = "60";
            document.getElementById('pitch-timer').style.color = "#bb86fc";
            document.getElementById('pitch-genre').innerText = pitchData.genres[Math.floor(Math.random() * pitchData.genres.length)];
            document.getElementById('pitch-hero').innerText = pitchData.heroes[Math.floor(Math.random() * pitchData.heroes.length)];
            document.getElementById('pitch-twist').innerText = pitchData.twists[Math.floor(Math.random() * pitchData.twists.length)];
        }

        function startPitchTimer() {
            playSound('swipe');
            clearInterval(pitchTimer);
            let time = 60;
            const display = document.getElementById('pitch-timer');
            pitchTimer = setInterval(() => {
                time--;
                display.innerText = time;
                if(time <= 10) display.style.color = "#cf6679"; 
                if(time <= 0) {
                    clearInterval(pitchTimer);
                    playSound('alarm');
                    display.innerText = "TIME!";
                }
            }, 1000);
        }

        // --- GAME 3: BINGO ---
        let markedIndices = [];
        function newBingoGame() {
            playSound('swipe');
            let deck = [...bingoItems];
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            const selected = deck.slice(0, 24);
            selected.splice(12, 0, "FREE SPACE");
            markedIndices = [12];
            renderBingo(selected);
        }

        function renderBingo(items) {
            const grid = document.getElementById('bingo-grid');
            grid.innerHTML = '';
            items.forEach((item, index) => {
                const tile = document.createElement('div');
                tile.className = 'bingo-tile';
                tile.innerText = item;
                if(index === 12) tile.classList.add('free', 'marked');
                tile.onclick = () => {
                    if(index === 12) return;
                    if(markedIndices.includes(index)) {
                        markedIndices = markedIndices.filter(i => i !== index);
                        tile.classList.remove('marked');
                        playSound('unpop');
                    } else {
                        markedIndices.push(index);
                        tile.classList.add('marked');
                        playSound('pop');
                        checkBingo();
                    }
                };
                grid.appendChild(tile);
            });
        }

        function checkBingo() {
            const wins = [
                [0,1,2,3,4], [5,6,7,8,9], [10,11,12,13,14], [15,16,17,18,19], [20,21,22,23,24],
                [0,5,10,15,20], [1,6,11,16,21], [2,7,12,17,22], [3,8,13,18,23], [4,9,14,19,24],
                [0,6,12,18,24], [4,8,12,16,20]
            ];
            if(wins.some(combo => combo.every(i => markedIndices.includes(i)))) {
                playSound('win');
                fireConfetti();
                document.getElementById('overlay').classList.add('visible');
            }
        }

        function fireConfetti() {
            const canvas = document.getElementById('confetti-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            const particles = [];
            for(let i=0; i<80; i++) {
                particles.push({
                    x: window.innerWidth / 2, y: window.innerHeight / 2,
                    vx: (Math.random() - 0.5) * 25, vy: (Math.random() - 0.5) * 25,
                    color: `hsl(${Math.random()*360}, 100%, 50%)`, life: 120
                });
            }
            function animate() {
                ctx.clearRect(0,0,canvas.width, canvas.height);
                let active = false;
                particles.forEach(p => {
                    if(p.life > 0) {
                        p.x += p.vx; p.y += p.vy; p.vy += 0.5; p.life -= 2;
                        ctx.fillStyle = p.color; ctx.fillRect(p.x, p.y, 6, 6);
                        active = true;
                    }
                });
                if(active) requestAnimationFrame(animate);
            }
            animate();
        }
    </script>
</body>
</html>
