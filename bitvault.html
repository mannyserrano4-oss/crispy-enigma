<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Comedy Vault</title>
    
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="icon" type="image/png" href="icon.png">

    <style>
        :root {
            --bg: #121212;
            --card: #1e1e1e;
            --text: #ffffff;
            --accent: #feca57; /* Gold/Yellow */
            --danger: #ff6b6b;
            --border: #333;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0; padding: 0;
            display: flex; flex-direction: column;
            height: 100vh; overflow: hidden;
        }

        /* HEADER */
        .header {
            padding: 15px;
            background: rgba(30, 30, 30, 0.95);
            border-bottom: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center;
            z-index: 10;
        }
        h1 { margin: 0; font-size: 1.2rem; text-transform: uppercase; letter-spacing: 2px; color: var(--accent); }
        
        .btn-icon { background: none; border: none; font-size: 1.5rem; cursor: pointer; text-decoration: none;}

        /* FILTER BAR */
        .filter-scroll {
            display: flex; gap: 10px; padding: 10px 15px;
            overflow-x: auto; background: var(--bg);
            border-bottom: 1px solid var(--border); flex-shrink: 0;
        }
        .filter-chip {
            background: var(--card); padding: 6px 14px;
            border-radius: 20px; font-size: 0.85rem; color: #888;
            border: 1px solid var(--border); white-space: nowrap; cursor: pointer;
        }
        .filter-chip.active {
            background: var(--accent); color: black; font-weight: bold; border-color: var(--accent);
        }

        /* LIST AREA */
        #bit-list {
            flex-grow: 1; overflow-y: auto; padding: 15px;
            display: flex; flex-direction: column; gap: 10px;
        }

        .bit-card {
            background: var(--card); padding: 15px; border-radius: 12px;
            border-left: 4px solid var(--accent); position: relative;
        }

        .bit-content { font-size: 1.1rem; line-height: 1.4; white-space: pre-wrap; margin-bottom: 8px; }
        
        .bit-meta {
            display: flex; justify-content: space-between; align-items: center;
            font-size: 0.75rem; color: #666;
        }
        
        .tag-badge { 
            background: #333; padding: 2px 8px; border-radius: 4px; 
            color: #aaa; text-transform: uppercase; font-size: 0.65rem; letter-spacing: 1px;
        }

        .delete-btn { color: var(--danger); cursor: pointer; padding: 5px; font-size: 1rem; }

        /* INPUT AREA */
        .input-area {
            background: var(--card); padding: 15px;
            border-top: 1px solid var(--border);
            display: flex; flex-direction: column; gap: 10px;
            padding-bottom: max(15px, env(safe-area-inset-bottom));
        }

        textarea {
            background: #111; border: 1px solid var(--border);
            color: white; padding: 12px; border-radius: 8px;
            resize: none; height: 60px; font-family: inherit; font-size: 1rem;
        }
        textarea:focus { outline: 2px solid var(--accent); border-color: transparent; }

        .input-row { display: flex; gap: 10px; }
        
        select { background: #333; color: white; border: none; padding: 0 10px; border-radius: 8px; flex-grow: 1; }

        .btn-add {
            background: var(--accent); color: black; border: none;
            padding: 12px 25px; border-radius: 8px; font-weight: bold;
            text-transform: uppercase; cursor: pointer;
        }
        
        /* SETTINGS MENU (Hidden by default) */
        #settings-menu {
            position: absolute; top: 60px; right: 10px;
            background: #252525; border: 1px solid #444;
            border-radius: 8px; padding: 10px;
            display: none; flex-direction: column; gap: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); z-index: 100;
        }
        #settings-menu.visible { display: flex; }
        
        .menu-btn {
            background: #333; color: white; border: none; padding: 10px;
            border-radius: 5px; cursor: pointer; text-align: left; font-size: 0.9rem;
        }

    </style>
</head>
<body>

    <div class="header">
        <a href="../apps.html" class="btn-icon">üè†</a>
        <h1>Comedy Vault</h1>
        <button class="btn-icon" onclick="toggleMenu()">‚öôÔ∏è</button>
    </div>

    <div id="settings-menu">
        <button class="menu-btn" onclick="shareToNotes()">üìù Export to Notes App</button>
        <button class="menu-btn" onclick="exportData()">üíæ Backup to File</button>
        <button class="menu-btn" onclick="document.getElementById('file-input').click()">üìÇ Restore from File</button>
        <div style="font-size:0.7rem; color:#888; text-align:center;">Safe & Secure</div>
    </div>
    
    <input type="file" id="file-input" style="display:none" onchange="importData(this)">

    <div class="filter-scroll">
        <div class="filter-chip active" onclick="filterBits('all', this)">All</div>
        <div class="filter-chip" onclick="filterBits('New', this)">New</div>
        <div class="filter-chip" onclick="filterBits('Opener', this)">Opener</div>
        <div class="filter-chip" onclick="filterBits('Closer', this)">Closer</div>
        <div class="filter-chip" onclick="filterBits('Roast', this)">Roast</div>
        <div class="filter-chip" onclick="filterBits('Crowd Work', this)">Crowd</div>
        <div class="filter-chip" onclick="filterBits('Dark', this)">Dark</div>
    </div>

    <div id="bit-list"></div>

    <div class="input-area">
        <textarea id="new-text" placeholder="Write a new premise..."></textarea>
        <div class="input-row">
            <select id="new-tag">
                <option value="New">New Idea</option>
                <option value="Opener">Opener</option>
                <option value="Closer">Closer</option>
                <option value="Roast">Roast</option>
                <option value="Crowd Work">Crowd Work</option>
                <option value="Dark">Dark</option>
            </select>
            <button class="btn-add" onclick="addBit()">Add</button>
        </div>
    </div>

    <script>
        let bits = JSON.parse(localStorage.getItem('comedy_bits') || '[]');
        let currentFilter = 'all';

        function render() {
            const list = document.getElementById('bit-list');
            list.innerHTML = '';
            
            const visibleBits = currentFilter === 'all' ? bits : bits.filter(b => b.tag === currentFilter);

            if (visibleBits.length === 0) {
                list.innerHTML = '<div style="text-align:center; color:#444; margin-top:50px;">Nothing here yet.</div>';
                return;
            }

            visibleBits.forEach(bit => {
                const div = document.createElement('div');
                div.className = 'bit-card';
                div.innerHTML = `
                    <div class="bit-content">${escapeHtml(bit.text)}</div>
                    <div class="bit-meta">
                        <span class="tag-badge">${bit.tag}</span>
                        <div style="display:flex; gap:15px; align-items:center;">
                            <span>${new Date(bit.date).toLocaleDateString()}</span>
                            <span class="delete-btn" onclick="deleteBit(${bit.id})">üóëÔ∏è</span>
                        </div>
                    </div>
                `;
                list.appendChild(div);
            });
        }

        function addBit() {
            const input = document.getElementById('new-text');
            const tagSelect = document.getElementById('new-tag');
            const text = input.value.trim();
            if (!text) return;

            const newBit = { id: Date.now(), text: text, tag: tagSelect.value, date: Date.now() };
            bits.unshift(newBit);
            save();
            input.value = '';
            render();
        }

        function deleteBit(id) {
            if(confirm("Delete this joke?")) {
                bits = bits.filter(b => b.id !== id);
                save();
                render();
            }
        }

        function filterBits(tag, element) {
            currentFilter = tag;
            document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
            element.classList.add('active');
            render();
        }

        function toggleMenu() {
            const menu = document.getElementById('settings-menu');
            menu.classList.toggle('visible');
        }

        // --- SHARE TO NOTES (THE NEW FEATURE) ---
        function shareToNotes() {
            if (!navigator.share) {
                alert("Your browser doesn't support sharing. Try Safari on iPhone.");
                return;
            }

            // Create a nice text list of all jokes
            let textToShare = "üé§ MY COMEDY BITS \n\n";
            bits.forEach(b => {
                textToShare += `[${b.tag.toUpperCase()}] \n${b.text} \n-------------------\n`;
            });

            // Open iOS Share Sheet
            navigator.share({
                title: 'Comedy Vault Backup',
                text: textToShare
            }).catch(console.error);
        }

        // --- BACKUP TO FILE (THE SAFETY NET) ---
        function exportData() {
            const dataStr = JSON.stringify(bits, null, 2);
            const blob = new Blob([dataStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `jokes_backup_${new Date().toISOString().slice(0,10)}.json`;
            a.click();
            
            toggleMenu(); 
        }

        // --- RESTORE FROM FILE ---
        function importData(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedBits = JSON.parse(e.target.result);
                    if (Array.isArray(importedBits)) {
                        if(confirm(`Found ${importedBits.length} jokes. This will OVERWRITE current list. Continue?`)) {
                            bits = importedBits;
                            save();
                            render();
                            alert("Jokes restored!");
                        }
                    } else {
                        alert("Invalid file.");
                    }
                } catch (err) {
                    alert("Error reading file.");
                }
            };
            reader.readAsText(file);
            toggleMenu();
        }

        function save() { localStorage.setItem('comedy_bits', JSON.stringify(bits)); }
        function escapeHtml(text) {
            return text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
        }

        render();
    </script>
</body>
</html>
