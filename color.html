<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MAS Color Lab | Pro</title>
    <style>
        :root { --bg: #0a0a0c; --card: #16161a; --text: #ececed; --accent: #38bdf8; --border: #2d2d33; }
        body { background: var(--bg); color: var(--text); font-family: 'Inter', -apple-system, sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* Left Panel: Adobe-style Sidebar */
        .sidebar { width: 380px; border-right: 1px solid var(--border); padding: 24px; overflow-y: auto; background: var(--card); display: flex; flex-direction: column; gap: 20px; }
        .drop-zone { border: 2px dashed var(--accent); border-radius: 12px; padding: 20px; text-align: center; cursor: pointer; background: rgba(56, 189, 248, 0.03); transition: 0.2s; }
        .drop-zone:hover { background: rgba(56, 189, 248, 0.08); }

        /* Color Wheel Display */
        .wheel-container { display: flex; justify-content: center; margin: 10px 0; position: relative; }
        #color-wheel { width: 220px; height: 220px; border-radius: 50%; cursor: crosshair; border: 4px solid var(--border); }

        /* Harmony Controls */
        .section-title { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; color: #71717a; margin-bottom: 8px; font-weight: 700; }
        .harmony-select { width: 100%; padding: 12px; background: #000; color: #fff; border: 1px solid var(--border); border-radius: 8px; font-size: 0.9rem; margin-bottom: 10px; }
        
        .palette-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin-bottom: 10px; }
        .swatch { aspect-ratio: 1/1; border-radius: 6px; cursor: pointer; border: 2px solid transparent; transition: 0.2s; position: relative; }
        .swatch.active { border-color: var(--accent); transform: scale(1.05); }
        .swatch-hex { font-size: 0.65rem; color: #71717a; text-align: center; margin-top: 4px; font-family: monospace; }

        .definition-card { font-size: 0.8rem; line-height: 1.5; background: rgba(56, 189, 248, 0.05); padding: 16px; border-radius: 10px; border: 1px solid rgba(56, 189, 248, 0.15); }
        .definition-card b { color: var(--accent); display: block; margin-bottom: 4px; }

        /* Main Viewport */
        .main-stage { flex: 1; background: #000; position: relative; overflow: hidden; cursor: crosshair; }
        #canvas-holder { transform-origin: center; transition: transform 0.1s ease-out; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        canvas { max-width: 85vw; max-height: 85vh; box-shadow: 0 20px 50px rgba(0,0,0,0.5); image-rendering: pixelated; }

        /* Zoom Toolbar */
        .zoom-bar { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); background: rgba(22, 22, 26, 0.9); padding: 12px 24px; border-radius: 50px; display: flex; gap: 24px; align-items: center; border: 1px solid var(--border); backdrop-filter: blur(12px); box-shadow: 0 10px 30px rgba(0,0,0,0.4); }
        .zoom-bar label { font-size: 0.7rem; font-weight: bold; color: #a1a1aa; }
        input[type="range"] { width: 120px; accent-color: var(--accent); }
        .action-btn { background: var(--accent); color: #000; border: none; padding: 10px 20px; border-radius: 30px; font-weight: 700; cursor: pointer; font-size: 0.85rem; }
    </style>
</head>
<body>

    <aside class="sidebar">
        <div class="drop-zone" onclick="document.getElementById('file-input').click()">
            <div style="font-weight: 800; color: var(--accent); font-size: 0.9rem;">IMPORT DESIGN</div>
            <div style="font-size: 0.7rem; color: #71717a; margin-top: 4px;">PNG, JPG, JPEG</div>
            <input type="file" id="file-input" accept="image/*" hidden>
        </div>

        <div>
            <div class="section-title">Color Harmony</div>
            <select id="harmony-mode" class="harmony-select">
                <option value="analogous">Analogous</option>
                <option value="monochromatic">Monochromatic</option>
                <option value="complementary">Complementary</option>
                <option value="triad">Triad</option>
                <option value="manual">Manual / Eyedropper</option>
            </select>
        </div>

        <div class="wheel-container">
            <canvas id="color-wheel"></canvas>
        </div>

        <div>
            <div class="section-title">Current Palette</div>
            <div class="palette-grid" id="palette-display">
                </div>
        </div>

        <div id="theory-definition" class="definition-card">
            </div>

        <div style="display:flex; gap: 10px; margin-top: auto;">
            <button class="action-btn" id="download-btn" style="flex:1">EXPORT PNG</button>
            <button class="action-btn" onclick="resetCanvas()" style="background:#2d2d33; color: white; flex:1">RESET</button>
        </div>
    </aside>

    <main class="main-stage" id="stage">
        <div id="canvas-holder">
            <canvas id="editor-canvas"></canvas>
        </div>
        
        <div class="zoom-bar">
            <div style="display:flex; align-items:center; gap:10px;">
                <label>ZOOM <span id="z-val">1</span>x</label>
                <input type="range" id="z-slider" min="1" max="10" step="0.1" value="1">
            </div>
            <div style="height: 20px; width: 1px; background: var(--border);"></div>
            <div style="color: var(--accent); font-family: monospace; font-size: 0.9rem;" id="active-hex">#000000</div>
        </div>
    </main>

    <script>
        const editor = document.getElementById('editor-canvas');
        const eCtx = editor.getContext('2d', { willReadFrequently: true });
        const wheel = document.getElementById('color-wheel');
        const wCtx = wheel.getContext('2d');
        const paletteDisplay = document.getElementById('palette-display');
        const zSlider = document.getElementById('z-slider');
        const holder = document.getElementById('canvas-holder');
        const theoryBox = document.getElementById('theory-definition');
        const activeHex = document.getElementById('active-hex');

        let imgData = null, originalData = null;
        let scale = 1, pX = 0, pY = 0, start = {x:0, y:0}, isDrag = false;
        let baseColor = {h: 200, s: 100, l: 50};
        let selectedSourceColor = null;

        const harmonies = {
            analogous: { name: "Analogous", def: "Colors sitting <b>next to each other</b> on the wheel. Creates calm, comfortable designs often found in nature.", degrees: [-30, 0, 30] },
            monochromatic: { name: "Monochromatic", def: "Variations in <b>brightness and saturation</b> of one hue. Great for a clean, sophisticated, and professional look.", degrees: [0], mods: [{l:-20}, {l:0}, {l:20}] },
            complementary: { name: "Complementary", def: "Colors from <b>opposite sides</b> of the wheel. Provides high contrast and high impact for making elements pop.", degrees: [0, 180] },
            triad: { name: "Triad", def: "Three colors <b>equally spaced</b> (120Â°). Offers vibrant contrast while maintaining balance.", degrees: [0, 120, 240] },
            manual: { name: "Manual", def: "Pick any color using the <b>eyedropper</b> on your design, then choose a new tone from the wheel.", degrees: [0] }
        };

        // Initialize Wheel
        function drawWheel() {
            const radius = wheel.width / 2;
            for(let i=0; i<360; i++) {
                const startAngle = (i-1) * Math.PI/180;
                const endAngle = (i+1) * Math.PI/180;
                wCtx.beginPath();
                wCtx.moveTo(radius, radius);
                wCtx.arc(radius, radius, radius, startAngle, endAngle);
                wCtx.fillStyle = `hsl(${i}, 100%, 50%)`;
                wCtx.fill();
            }
        }
        wheel.width = 440; wheel.height = 440; drawWheel();

        // Load Image
        document.getElementById('file-input').onchange = (e) => {
            const reader = new FileReader();
            reader.onload = (ev) => {
                const img = new Image();
                img.onload = () => {
                    editor.width = img.width; editor.height = img.height;
                    eCtx.drawImage(img, 0, 0);
                    imgData = eCtx.getImageData(0, 0, img.width, img.height);
                    originalData = eCtx.getImageData(0, 0, img.width, img.height);
                    updateTheory();
                };
                img.src = ev.target.result;
            };
            reader.readAsDataURL(e.target.files[0]);
        };

        // Recolor Logic
        editor.onclick = (e) => {
            const rect = editor.getBoundingClientRect();
            const x = Math.floor((e.clientX - rect.left) / (rect.width / editor.width));
            const y = Math.floor((e.clientY - rect.top) / (rect.height / editor.height));
            const pixel = eCtx.getImageData(x, y, 1, 1).data;
            selectedSourceColor = { r: pixel[0], g: pixel[1], b: pixel[2] };
            activeHex.innerText = rgbToHex(pixel[0], pixel[1], pixel[2]);
        };

        wheel.onclick = (e) => {
            const rect = wheel.getBoundingClientRect();
            const x = e.clientX - rect.left - (rect.width/2);
            const y = e.clientY - rect.top - (rect.height/2);
            const angle = Math.atan2(y, x) * (180 / Math.PI) + 90;
            baseColor.h = (angle + 360) % 360;
            updatePalette();
        };

        function updatePalette() {
            const mode = document.getElementById('harmony-mode').value;
            const config = harmonies[mode];
            paletteDisplay.innerHTML = '';
            
            config.degrees.forEach((deg, i) => {
                const h = (baseColor.h + deg + 360) % 360;
                const l = config.mods ? baseColor.l + config.mods[i].l : baseColor.l;
                const hex = hslToHex(h, baseColor.s, l);
                
                const s = document.createElement('div');
                s.className = 'swatch';
                s.style.background = hex;
                s.onclick = () => {
                    if(selectedSourceColor) applyColorSwap(selectedSourceColor, hexToRgb(hex));
                };
                paletteDisplay.appendChild(s);
            });
        }

        function applyColorSwap(target, replacement) {
            const data = imgData.data;
            for(let i=0; i<data.length; i+=4) {
                if(data[i] === target.r && data[i+1] === target.g && data[i+2] === target.b) {
                    data[i] = replacement.r; data[i+1] = replacement.g; data[i+2] = replacement.b;
                }
            }
            eCtx.putImageData(imgData, 0, 0);
        }

        // Zoom & Pan
        zSlider.oninput = () => {
            scale = zSlider.value;
            document.getElementById('z-val').innerText = scale;
            applyTransform();
        };
        function applyTransform() { holder.style.transform = `translate(calc(-50% + ${pX}px), calc(-50% + ${pY}px)) scale(${scale})`; }
        
        const stage = document.getElementById('stage');
        stage.onmousedown = (e) => { isDrag = true; start = {x: e.clientX - pX, y: e.clientY - pY}; };
        window.onmousemove = (e) => { if(isDrag) { pX = e.clientX - start.x; pY = e.clientY - start.y; applyTransform(); }};
        window.onmouseup = () => isDrag = false;

        function updateTheory() {
            const mode = document.getElementById('harmony-mode').value;
            theoryBox.innerHTML = `<b>${harmonies[mode].name}</b>${harmonies[mode].def}`;
            updatePalette();
        }
        document.getElementById('harmony-mode').onchange = updateTheory;

        // Utilities
        function rgbToHex(r, g, b) { return "#" + [r, g, b].map(x => x.toString(16).padStart(2, '0')).join('').toUpperCase(); }
        function hexToRgb(hex) {
            const r = parseInt(hex.slice(1, 3), 16), g = parseInt(hex.slice(3, 5), 16), b = parseInt(hex.slice(5, 7), 16);
            return {r, g, b};
        }
        function hslToHex(h, s, l) {
            l /= 100; const a = s * Math.min(l, 1 - l) / 100;
            const f = n => {
                const k = (n + h / 30) % 12;
                const color = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);
                return Math.round(255 * color).toString(16).padStart(2, '0');
            };
            return `#${f(0)}${f(8)}${f(4)}`.toUpperCase();
        }
        function resetCanvas() { eCtx.putImageData(originalData, 0, 0); imgData = eCtx.getImageData(0,0,editor.width,editor.height); }
        document.getElementById('download-btn').onclick = () => {
            const a = document.createElement('a'); a.download = 'MAS-Color.png'; a.href = editor.toDataURL(); a.click();
        };
    </script>
</body>
</html>
